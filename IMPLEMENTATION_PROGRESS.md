# å•†æˆ·è¯¦ç»†è¿è¥æ•°æ®æ‰©å±• - å®æ–½è¿›åº¦

## ğŸ“Š æ€»ä½“è¿›åº¦ï¼š38% (3/8 ä»»åŠ¡å®Œæˆ)

---

## âœ… å·²å®Œæˆä»»åŠ¡

### Task #1: æ‰©å±• Merchant ç±»å‹å®šä¹‰ âœ…
**æ–‡ä»¶:** `types/index.ts`

- âœ… æ·»åŠ  `OperationalDetails` æ¥å£åˆ° Merchant
- âœ… åŒ…å«7å¤§æ•°æ®ç±»åˆ«ï¼š
  - é€šç”¨æ•°æ®ï¼ˆæ—¥å‡å®¢æµã€è½¬åŒ–ç‡ç­‰ï¼‰
  - é¤é¥®ä¸“å±ï¼ˆç¿»å°ç‡ã€é”™æ¼å•ç‡ç­‰ï¼‰
  - é›¶å”®ä¸“å±ï¼ˆåº“å­˜å‘¨è½¬ç‡ã€é€€è´§ç‡ç­‰ï¼‰
  - é¡¾å®¢æ•°æ®ï¼ˆNPSã€å¤è´­ç‡ç­‰ï¼‰
  - å‘˜å·¥æ•°æ®ï¼ˆäººæ•°ã€æµå¤±ç‡ç­‰ï¼‰
  - ç«äº‰ç¯å¢ƒï¼ˆç«å“æ•°é‡ã€å¸‚åœºä»½é¢ç­‰ï¼‰
  - ä½ç½®æ•°æ®ï¼ˆæ¥¼å±‚ã€åŒºåŸŸç±»å‹ç­‰ï¼‰
- âœ… å…ƒæ•°æ®æ”¯æŒï¼ˆæ•°æ®æ¥æºã€å½•å…¥äººã€æ›´æ–°æ—¶é—´ç­‰ï¼‰

**Git Commit:** 40e7ef0

---

### Task #2: åˆ›å»ºé…ç½®æ–‡ä»¶ âœ…
**æ–‡ä»¶:** `config/operationalDataConfig.ts`

- âœ… ä¸šæ€å­—æ®µæ˜ å°„ (`OPERATIONAL_FIELDS_BY_CATEGORY`)
  - é¤é¥®-ç«é”…ï¼šæ˜¾ç¤ºé€šç”¨+é¤é¥®+é¡¾å®¢+å‘˜å·¥+ç«äº‰+ä½ç½®
  - é›¶å”®-æœé¥°ï¼šæ˜¾ç¤ºé€šç”¨+é›¶å”®+é¡¾å®¢+å‘˜å·¥+ç«äº‰+ä½ç½®
  - ç­‰9ç§ä¸šæ€é…ç½®
- âœ… å­—æ®µæ ‡ç­¾ä¸­æ–‡æ˜ å°„ (`FIELD_LABELS`)
- âœ… å•ä½æ˜ å°„ (`FIELD_UNITS`) - äººæ¬¡ã€%ã€å…ƒã€æ¬¡/å¤©ç­‰
- âœ… æç¤ºä¿¡æ¯ (`FIELD_TOOLTIPS`) - è¡Œä¸šå‚è€ƒå€¼å’Œè¯´æ˜
- âœ… ä¸‹æ‹‰é€‰é¡¹é…ç½®ï¼š
  - æ•°æ®æ¥æºé€‰é¡¹
  - ç«äº‰å®šä½é€‰é¡¹ï¼ˆé¢†å…ˆ/æŒå¹³/è½åï¼‰
  - åŒºåŸŸç±»å‹é€‰é¡¹ï¼ˆä¸»åŠ¨çº¿/æ¬¡åŠ¨çº¿ç­‰ï¼‰
- âœ… å·¥å…·å‡½æ•°ï¼š
  - `getFieldGroupsByCategory()` - æ ¹æ®ä¸šæ€è·å–å­—æ®µç»„
  - `shouldShowField()` - åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå­—æ®µ

**Git Commit:** 40e7ef0

---

### Task #3: åˆ›å»ºå­—æ®µç»„ä»¶ âœ…
**æ–‡ä»¶:** `components/merchants/OperationalDataFields.tsx`

- âœ… åŸºç¡€ç»„ä»¶ï¼š
  - `FormField` - é€šç”¨è¡¨å•å­—æ®µï¼ˆæ”¯æŒnumber/text/selectï¼‰
  - `CheckboxField` - å¤é€‰æ¡†å­—æ®µ
- âœ… 7ä¸ªå­—æ®µç»„ç»„ä»¶ï¼š
  - `GeneralFields` - é€šç”¨æ•°æ®ï¼ˆæ—¥å‡å®¢æµã€è½¬åŒ–ç‡ï¼‰
  - `RestaurantFields` - é¤é¥®æ•°æ®ï¼ˆç¿»å°ç‡ã€é”™æ¼å•ç‡ç­‰7ä¸ªå­—æ®µï¼‰
  - `RetailFields` - é›¶å”®æ•°æ®ï¼ˆåº“å­˜å‘¨è½¬ç‡ç­‰4ä¸ªå­—æ®µï¼‰
  - `CustomerFields` - é¡¾å®¢æ•°æ®ï¼ˆNPSã€å¤è´­ç‡ç­‰4ä¸ªå­—æ®µï¼‰
  - `StaffFields` - å‘˜å·¥æ•°æ®ï¼ˆäººæ•°ã€æµå¤±ç‡ç­‰5ä¸ªå­—æ®µï¼‰
  - `CompetitionFields` - ç«äº‰ç¯å¢ƒï¼ˆç«å“æ•°é‡ç­‰3ä¸ªå­—æ®µï¼‰
  - `LocationFields` - ä½ç½®æ•°æ®ï¼ˆæ¥¼å±‚ã€åŒºåŸŸç±»å‹ç­‰4ä¸ªå­—æ®µï¼‰
- âœ… åŠŸèƒ½ç‰¹æ€§ï¼š
  - æ•°å€¼èŒƒå›´éªŒè¯ï¼ˆmin/maxï¼‰
  - é”™è¯¯æç¤ºæ˜¾ç¤º
  - Tooltip æ”¯æŒ
  - å•ä½æ˜¾ç¤º
  - Tailwind CSS æ ·å¼ï¼ˆfocus ringã€error stateï¼‰

**Git Commit:** 40e7ef0

---

## ğŸš§ æœªå®Œæˆä»»åŠ¡

### Task #4: åˆ›å»ºä¸»è¡¨å•ç»„ä»¶ â¸ï¸
**æ–‡ä»¶:** `components/merchants/OperationalDataForm.tsx`ï¼ˆæœªåˆ›å»ºï¼‰

**éœ€è¦å®ç°ï¼š**
```typescript
interface Props {
  merchant: Merchant;
  onSave: (data: OperationalDetails) => void;
  onCancel?: () => void;
}
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
1. æ ¹æ®å•†æˆ·ä¸šæ€åŠ¨æ€æ˜¾ç¤ºå­—æ®µç»„
2. è¡¨å•éªŒè¯é€»è¾‘ï¼š
   - æ•°å€¼èŒƒå›´æ£€æŸ¥
   - å¼‚å¸¸å€¼è­¦å‘Šï¼ˆå¦‚ç¿»å°ç‡>10æ¬¡/å¤©ï¼‰
3. çŠ¶æ€ç®¡ç†ï¼š
   - `formData` - è¡¨å•æ•°æ®
   - `errors` - éªŒè¯é”™è¯¯
4. è‡ªåŠ¨å¡«å……å…ƒæ•°æ®ï¼š
   - `lastUpdated` - å½“å‰æ—¶é—´
   - `dataSource` - é»˜è®¤'manual'
   - `inspectorId/inspectorName` - å½“å‰ç”¨æˆ·ä¿¡æ¯
5. UIç»„ä»¶ï¼š
   - ä½¿ç”¨ `Modal` åŒ…è£…
   - ä½¿ç”¨æŠ˜å é¢æ¿ï¼ˆAccordionï¼‰åˆ†ç»„å­—æ®µ
   - ä¿å­˜/å–æ¶ˆæŒ‰é’®

**å‚è€ƒä»£ç æ¡†æ¶å·²åœ¨åŸæ–¹æ¡ˆä¸­æä¾›**

---

### Task #5: åˆ›å»ºæ•°æ®å±•ç¤ºç»„ä»¶ â¸ï¸
**æ–‡ä»¶:** `components/merchants/OperationalDataDisplay.tsx`ï¼ˆæœªåˆ›å»ºï¼‰

**éœ€è¦å®ç°ï¼š**
- ç½‘æ ¼å¸ƒå±€å±•ç¤ºå·²å½•å…¥çš„å­—æ®µ
- è·³è¿‡ç©ºå€¼å­—æ®µ
- æ˜¾ç¤ºå…ƒæ•°æ®ï¼š
  - æœ€åæ›´æ–°æ—¶é—´
  - å½•å…¥äºº
  - æ•°æ®æ¥æº
- `DataCard` å­ç»„ä»¶ï¼šæ˜¾ç¤ºå•ä¸ªæ•°æ®é¡¹ï¼ˆæ ‡ç­¾+å€¼+å•ä½ï¼‰

**å‚è€ƒä»£ç æ¡†æ¶å·²åœ¨åŸæ–¹æ¡ˆä¸­æä¾›**

---

### Task #6: é›†æˆåˆ°å•†æˆ·è¯¦æƒ…é¡µ â¸ï¸
**æ–‡ä»¶:** `app/archives/[merchantId]/page.tsx`ï¼ˆéœ€ä¿®æ”¹ï¼‰

**éœ€è¦å®ç°ï¼š**
1. å¯¼å…¥ç»„ä»¶ï¼š
   ```typescript
   import OperationalDataForm from '@/components/merchants/OperationalDataForm';
   import OperationalDataDisplay from '@/components/merchants/OperationalDataDisplay';
   ```

2. çŠ¶æ€ç®¡ç†ï¼š
   ```typescript
   const [showDataForm, setShowDataForm] = useState(false);
   ```

3. ä¿å­˜å¤„ç†ï¼š
   ```typescript
   const handleSaveOperationalData = (data: OperationalDetails) => {
     merchantDataManager.updateMerchant(merchant.id, {
       operationalDetails: data,
     });
     setShowDataForm(false);
   };
   ```

4. UIå¢å¼ºï¼š
   - å¢åŠ "è¿è¥æ•°æ®å¡ç‰‡"
   - "å½•å…¥æ•°æ®"/"ç¼–è¾‘æ•°æ®"æŒ‰é’®
   - æ˜¾ç¤º `OperationalDataDisplay` æˆ– `EmptyState`
   - æ¨¡æ€æ¡†æ˜¾ç¤º `OperationalDataForm`

**æ³¨æ„ï¼š** è¯¥æ–‡ä»¶å·²è¢«ä¿®æ”¹ï¼Œéœ€è¦å°å¿ƒåˆå¹¶

---

### Task #7: æ›´æ–° AI è¯Šæ–­å¼•æ“ â¸ï¸
**æ–‡ä»¶:** `skills/ai-diagnosis-engine.ts`ï¼ˆéœ€ä¿®æ”¹ï¼‰

**éœ€è¦å®ç°ï¼š**
1. ä¿®æ”¹ `analyzeCausalRelations` å‡½æ•°çš„ prompt
2. å¢åŠ è¯¦ç»†è¿è¥æ•°æ®éƒ¨åˆ†ï¼š
   ```typescript
   ${merchant.operationalDetails ? `
   # â­è¯¦ç»†è¿è¥æ•°æ®ï¼ˆå®é™…é‡‡é›†ï¼‰
   ${formatOperationalDetails(merchant.operationalDetails)}
   âš ï¸ ä»¥ä¸Šæ•°æ®ä¸º**çœŸå®é‡‡é›†æ•°æ®**ï¼Œè¯·åœ¨åˆ†æä¸­ä¼˜å…ˆä½¿ç”¨ã€‚
   ` : `
   # âš ï¸ æ³¨æ„ï¼šæ— è¯¦ç»†è¿è¥æ•°æ®
   å½“å‰åªæœ‰å¥åº·åº¦è¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰ï¼Œç¼ºä¹è¯¦ç»†ä¸šåŠ¡æŒ‡æ ‡ã€‚
   `}
   ```

3. å¢åŠ ä¸¥æ ¼æ•°æ®ä½¿ç”¨è§„åˆ™ï¼š
   - ç¦æ­¢ç¼–é€ æ•°æ®
   - åŒºåˆ†å®é™…æ•°æ®å’Œæ¨æµ‹
   - ä½¿ç”¨é™å®šè¯ï¼ˆ"å¯èƒ½"ã€"æ¨æµ‹"ï¼‰

4. ä¿®æ”¹è¾“å‡ºæ ¼å¼ï¼Œå¢åŠ  `dataSupport` å­—æ®µï¼š
   ```json
   {
     "rootCauses": [
       {
         "dataSupport": "strong | weak | speculative"
       }
     ]
   }
   ```

5. åˆ›å»ºè¾…åŠ©å‡½æ•°ï¼š
   ```typescript
   function formatOperationalDetails(data: OperationalDetails): string {
     const lines: string[] = [];
     if (data.dailyFootfall) lines.push(`- æ—¥å‡å®¢æµï¼š${data.dailyFootfall}äººæ¬¡`);
     if (data.restaurant?.turnoverRate) lines.push(`- ç¿»å°ç‡ï¼š${data.restaurant.turnoverRate}æ¬¡/å¤©`);
     // ... æ›´å¤šå­—æ®µ
     return lines.join('\n');
   }
   ```

---

### Task #8: éªŒè¯æ•°æ®ç®¡ç†å™¨ âœ…
**æ–‡ä»¶:** `utils/merchantDataManager.ts`

**å·²ç¡®è®¤ï¼š**
- âœ… `updateMerchant` æ–¹æ³•å·²æ”¯æŒæ·±åº¦åˆå¹¶ï¼ˆç³»ç»Ÿæé†’æ˜¾ç¤ºå·²ä¿®æ”¹ï¼‰
- âœ… ä¿å­˜åˆ° localStorage
- âœ… è§¦å‘è·¨æ ‡ç­¾é¡µåŒæ­¥äº‹ä»¶

**æ— éœ€é¢å¤–ä¿®æ”¹**

---

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—

### ç»§ç»­å¼€å‘æ—¶çš„æ­¥éª¤ï¼š

1. **åˆ›å»ºä¸»è¡¨å•ç»„ä»¶**ï¼ˆæœ€ä¼˜å…ˆï¼‰
   ```bash
   # åˆ›å»ºæ–‡ä»¶
   touch components/merchants/OperationalDataForm.tsx
   ```
   - å¤åˆ¶åŸæ–¹æ¡ˆä¸­çš„ä»£ç æ¡†æ¶
   - å®ç°è¡¨å•éªŒè¯é€»è¾‘
   - é›†æˆå·²åˆ›å»ºçš„å­—æ®µç»„ä»¶

2. **åˆ›å»ºå±•ç¤ºç»„ä»¶**
   ```bash
   touch components/merchants/OperationalDataDisplay.tsx
   ```
   - å®ç° `DataCard` ç»„ä»¶
   - ç½‘æ ¼å¸ƒå±€æ˜¾ç¤ºæ•°æ®
   - æ˜¾ç¤ºå…ƒæ•°æ®

3. **é›†æˆåˆ°è¯¦æƒ…é¡µ**
   - ä¿®æ”¹ `app/archives/[merchantId]/page.tsx`
   - æ³¨æ„ï¼šè¯¥æ–‡ä»¶å·²è¢«ä¿®æ”¹ï¼Œä½¿ç”¨ `await params` è¯­æ³•
   - åœ¨é€‚å½“ä½ç½®æ·»åŠ è¿è¥æ•°æ®å¡ç‰‡

4. **æ›´æ–° AI å¼•æ“**
   - ä¿®æ”¹ `skills/ai-diagnosis-engine.ts`
   - æ·»åŠ  `formatOperationalDetails` è¾…åŠ©å‡½æ•°
   - æ›´æ–° prompt

5. **æµ‹è¯•éªŒè¯**
   - åœºæ™¯1ï¼šæ•°æ®å½•å…¥å’Œä¿å­˜
   - åœºæ™¯2ï¼šLLMè¯Šæ–­å·®å¼‚å¯¹æ¯”
   - åœºæ™¯3ï¼šä¸šæ€å·®å¼‚åŒ–æ˜¾ç¤º
   - åœºæ™¯4ï¼šæ•°æ®æŒä¹…åŒ–

---

## ğŸ“Š æ–‡ä»¶æ¸…å•

### âœ… å·²åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `types/index.ts` - Merchant ç±»å‹æ‰©å±•
- âœ… `config/operationalDataConfig.ts` - é…ç½®æ–‡ä»¶
- âœ… `components/merchants/OperationalDataFields.tsx` - å­—æ®µç»„ä»¶

### â¸ï¸ å¾…åˆ›å»ºçš„æ–‡ä»¶
- â¸ï¸ `components/merchants/OperationalDataForm.tsx` - ä¸»è¡¨å•
- â¸ï¸ `components/merchants/OperationalDataDisplay.tsx` - å±•ç¤ºç»„ä»¶

### â¸ï¸ å¾…ä¿®æ”¹çš„æ–‡ä»¶
- â¸ï¸ `app/archives/[merchantId]/page.tsx` - è¯¦æƒ…é¡µé›†æˆ
- â¸ï¸ `skills/ai-diagnosis-engine.ts` - AIå¼•æ“æ›´æ–°

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### å·²è§£å†³çš„é—®é¢˜
1. âœ… TypeScript ç±»å‹å®šä¹‰å®Œæ•´
2. âœ… ä¸šæ€åŠ¨æ€å­—æ®µæ˜ å°„
3. âœ… å¯å¤ç”¨å­—æ®µç»„ä»¶
4. âœ… è¡¨å•éªŒè¯æ¡†æ¶

### å¾…è§£å†³çš„é—®é¢˜
1. â¸ï¸ è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆinspectorId/inspectorNameï¼‰
2. â¸ï¸ è¡¨å•éªŒè¯é”™è¯¯å¤„ç†ï¼ˆtoastæç¤ºï¼‰
3. â¸ï¸ æŠ˜å é¢æ¿ç»„ä»¶ï¼ˆå¯èƒ½éœ€è¦åˆ›å»ºæˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼‰
4. â¸ï¸ EmptyState ç»„ä»¶ï¼ˆå¯èƒ½éœ€è¦åˆ›å»ºï¼‰

---

## ğŸ’¡ é‡è¦æé†’

1. **æ•°æ®æŒä¹…åŒ–**ï¼šå½“å‰ä½¿ç”¨ localStorageï¼Œæœªæ¥éœ€è¿ç§»åˆ°åç«¯
2. **ç”¨æˆ·ä¿¡æ¯**ï¼šéœ€å®ç°è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„å‡½æ•°
3. **Modal ç»„ä»¶**ï¼šå·²å­˜åœ¨äº `components/ui/Modal.tsx`ï¼Œå¯ç›´æ¥ä½¿ç”¨
4. **æ ·å¼è§„èŒƒ**ï¼šä½¿ç”¨ Tailwind CSSï¼Œå‚è€ƒç°æœ‰ç»„ä»¶é£æ ¼
5. **Git æäº¤**ï¼šå½“å‰è¿›åº¦å·²æäº¤åˆ° commit 40e7ef0

---

## ğŸ“ˆ é¢„ä¼°å‰©ä½™å·¥ä½œé‡

- Task #4 (ä¸»è¡¨å•): ~1-2å°æ—¶
- Task #5 (å±•ç¤ºç»„ä»¶): ~30åˆ†é’Ÿ
- Task #6 (é¡µé¢é›†æˆ): ~30åˆ†é’Ÿ
- Task #7 (AIå¼•æ“): ~1å°æ—¶
- æµ‹è¯•éªŒè¯: ~1å°æ—¶

**æ€»è®¡: çº¦3.5-4.5å°æ—¶**

---

ç”Ÿæˆæ—¶é—´: 2026-02-09
å½“å‰åˆ†æ”¯: main
æœ€æ–°æäº¤: 40e7ef0 - feat: æ·»åŠ å•†æˆ·è¯¦ç»†è¿è¥æ•°æ®åŸºç¡€æ¶æ„ - Phase 1/4
