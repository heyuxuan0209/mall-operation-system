# 🔧 数据一致性修复指导

**修复时间**: 2026-02-01 19:30
**问题**: 浏览器localStorage数据与数据源不一致
**状态**: 🔄 执行中

---

## 📊 问题确认

### 数据源（正确数据）
从 `data/merchants/mock-data.ts` 和 `data/cases/knowledge_base.json`:
- ✅ 商户总数: **18户**
- ✅ 高风险商户: **2户** (M001 海底捞45分, M005 绿茶58分)
- ✅ 平均健康度: **78分** (1397÷18=77.6→78)
- ✅ 知识库案例: **26个** (grep -c '"id":' = 26)

### 浏览器显示（错误数据）
- ✅ 商户总数: 18户 ← 正确
- ❌ 高风险商户: 1户 ← **错误，应为2户**
- ❌ 平均健康度: 80分 ← **错误，应为78分**
- ✅ 知识库案例: 26个 ← 正确

### 文档脚本（错误数据）
- ❌ 知识库案例: 47个 ← **错误，应为26个**

---

## 🎯 第一步：清除浏览器localStorage（立即执行）

### 操作方法

1. **在浏览器中**，确保你访问了 `http://localhost:3000`

2. **打开开发者工具**:
   - Mac: `Cmd + Option + I`
   - Windows: `F12`

3. **切换到 Console（控制台）标签**

4. **在控制台中输入以下命令并回车**:
   ```javascript
   localStorage.clear()
   location.reload()
   ```

5. **页面会自动刷新**，数据重新从数据源加载

---

## ✅ 第二步：验证浏览器数据已修复

刷新后，首页应该显示：

- [ ] **商户总数**: 18户 ✓
- [ ] **高风险商户**: **2户** ✓ ← 应该从1户变为2户了
- [ ] **平均健康度**: **78分** ✓ ← 应该从80分变为78分了
- [ ] **知识库案例**: 26个 ✓

### 待处理商户列表应该包含：
- [ ] **海底捞火锅** - 45分 (高风险) ← 这个应该显示了
- [ ] **绿茶餐厅** - 58分 (高风险) ← 这个也应该显示

---

## 📝 第三步：文档修复（我已完成）

以下文件中的 "47个案例" 已修改为 "26个案例":
- ✅ docs/snapshots/SESSION-HANDOVER-2026-02-01.md
- ✅ docs/USER-JOURNEY-FOR-DEMO.md
- ✅ docs/RECORDING-PREP-CHECK.md

---

## 🎙️ 第四步：配音文件（无需修改）

检查结果：配音文件中**没有提到具体数字**，只说"成功案例"，因此：
- ✅ **无需重新生成配音文件**

---

## 🔍 数据验证清单

### 商户数据验证
- [ ] 首页显示 2户高风险商户
- [ ] 待处理商户列表有海底捞（45分）
- [ ] 待处理商户列表有绿茶（58分）
- [ ] 平均健康度显示78分
- [ ] 健康度分布饼图显示 11% 高风险（2/18=11.1%）

### 高风险商户详细信息
**M001 海底捞火锅**:
- 健康度: 45分
- 风险等级: 高风险
- 租售比: 28%
- 上月营收: 471,000元
- 五维指标: 经营表现35分、抗风险能力35分（最弱）

**M005 绿茶餐厅**:
- 健康度: 58分
- 风险等级: 高风险
- 租售比: 29.7%
- 上月营收: 320,000元

---

## 🎬 第五步：录制前最终确认

### 数据一致性检查
- [ ] 浏览器数据 ✓ = 数据源 (localStorage已清除)
- [ ] 脚本内容 ✓ = 数据源 (文档已修复)
- [ ] 配音内容 ✓ = 脚本 (无需修改)

### 关键演示点检查
- [ ] 首页仪表板: 2户高风险、78分平均
- [ ] 待处理商户: 海底捞45分排第一
- [ ] 商户详情: 五维雷达图显示正确
- [ ] AI诊断: 核心问题、推荐措施、匹配案例
- [ ] 商户对比: 海底捞 vs 蜀大侠 vs 小龙坎

---

## ⚠️ 常见问题

### Q: 为什么浏览器数据会不一致？
**A**: 系统使用localStorage存储数据。如果之前测试时修改过某个商户的数据，localStorage会保留旧数据。清除后会重新从数据源加载。

### Q: 如果清除后还是不对怎么办？
**A**:
1. 硬刷新页面: `Cmd + Shift + R` (Mac) 或 `Ctrl + Shift + R` (Windows)
2. 检查浏览器控制台是否有JavaScript错误
3. 重启开发服务器: `npm run dev`

### Q: 脚本说的数据和我看到的不一样？
**A**: 确保:
1. localStorage已清除
2. 页面已刷新
3. 查看的是修复后的脚本文档（检查git status）

---

## 📋 执行状态

- [x] 分析问题根源
- [x] 修复文档中的"47个案例"→"26个案例"
- [ ] **用户清除浏览器localStorage** ← 你现在需要做这个
- [ ] 验证数据一致性
- [ ] 开始录制

---

## 🚀 立即执行

**现在请你：**

1. **打开浏览器** http://localhost:3000
2. **按 F12** 打开开发者工具
3. **在控制台输入**:
   ```javascript
   localStorage.clear()
   location.reload()
   ```
4. **检查首页数据** 是否显示 2户高风险、78分平均
5. **回复我** "数据已修复" 或 截图给我看

---

**文档修复完成时间**: 2026-02-01 19:30
**下一步**: 等待用户清除localStorage并验证
