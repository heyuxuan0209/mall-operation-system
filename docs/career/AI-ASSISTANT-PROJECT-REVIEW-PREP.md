# AI问答助手Agent重构 - 项目复盘准备

**复盘目的**: 为简历和面试准备，展示AI产品设计和技术实现能力

---

## 🎯 项目背景

### 项目名称
商户智运Agent - AI问答助手模块重构（v3.0 + v3.1）

### 时间线
- **v3.0**: 2026-02-07~02-11 - AI问答助手Agent化重构
- **v3.1**: 2026-02-10~02-11 - 商户详细运营数据扩展 + 数据可视化

### 核心问题
**用户反馈**: "答非所问、僵化、千篇一律"
- 无法处理聚合统计查询（"这个月多少高风险商户？"）
- 无法理解上下文（"小龙坎呢？"）
- 诊断千篇一律（只有标签，没有根因分析）
- AI只能基于健康度评分推测，缺乏详细运营数据支持

---

## 🚀 解决方案

### v3.0: 从Chatbot到AI Agent
**核心变革**: 规则匹配 → LLM推理驱动

**7个Phase重构**:
1. Query Understanding增强 - LLM结构化解析
2. Intent System重构 - 语义分类，支持复合意图
3. 诊断引擎重构 - 因果推理，根因分析
4. 案例匹配升级 - 语义相似度替代标签匹配
5. Response生成重构 - 动态生成替代固定模板
6. Agent Router扩展 - 支持聚合/对比查询
7. Context增强 - 多轮对话记忆

### v3.1: 数据驱动的精准诊断
**核心升级**: 健康度评分 → 详细运营数据

**3个Phase实施**:
1. **商户详细运营数据扩展** - 7大类别，30+字段（翻台率、NPS、员工流失率等）
2. **AI助手增强** - 图标升级（显眼度+200%）+ 响应优化（去Markdown，智能可视化）
3. **数据可视化** - 关键指标预警 + 运营趋势图 + 同业对比图

---

## 📊 核心成果

### 技术指标
- **代码量**: +2000行（v3.1）
- **Git提交**: 18 commits
- **新增组件**: 10个
- **功能完成度**: 100% (7/7 tasks)

### 业务价值
- ✅ 支持聚合统计查询（"多少高风险商户"）
- ✅ 支持对比分析查询（"vs上月"）
- ✅ AI诊断基于真实数据（翻台率1.2次/天 vs 推测"营收低"）
- ✅ 响应可视化（彩色卡片+图表 vs 纯文本）
- ✅ 6个核心指标实时预警
- ✅ 9个指标历史趋势分析
- ✅ 同业对比（雷达图+柱状图+排名）

### 用户体验提升
- **查询理解**: 关键词匹配 → LLM语义理解
- **诊断质量**: 症状检测 → 根因推理
- **响应格式**: Markdown文本 → 智能可视化
- **数据支持**: 健康度评分 → 30+详细指标

---

## 🎓 技术亮点

### 1. LLM驱动的查询理解
```typescript
// 结构化解析用户查询
Query: "这个月多少高风险商户，和上个月比怎么样"
↓
{
  type: "aggregation",
  entities: {merchants: ["all"], timeRange: "current_month"},
  intents: ["risk_statistics", "trend_comparison"],
  filters: {riskLevel: ["high", "critical"]},
  aggregations: {operation: "count"}
}
```

### 2. 因果推理诊断
```typescript
// 从症状到根因
旧: "营收低、客流少" (标签)
↓
新:
  根因1: 位置劣势（主因，置信度90%）
    - 证据: 3层客流比1-2层低40%
    - 影响: 翻台率仅1.2次/天（行业标准3.0次）
  根因2: 租金压力（次因，置信度80%）
    - 租售比28%（警戒线25%）
```

### 3. 智能响应可视化
```typescript
// 自动解析并生成可视化
AI响应: "这个月有2个高风险商户（海底捞、小龙坎）"
↓
解析: {stats: [{value: "2", label: "高风险商户"}], merchants: [...]}
↓
渲染: 彩色统计卡片 + 商户列表
```

### 4. localStorage深度合并
```typescript
// 解决新字段被覆盖问题
return {
  ...mockMerchant,           // 1. mockMerchants的所有字段
  ...storedMerchant,         // 2. localStorage覆盖
  operationalDetails: mockMerchant.operationalDetails ||
                      storedMerchant.operationalDetails  // 3. 确保新字段存在
};
```

---

## 🎯 面试要点

### 产品思维
1. **问题发现**: 如何从用户反馈识别核心问题？
2. **方案设计**: 为什么选择LLM而非规则引擎？
3. **优先级判断**: 为什么先做v3.0再做v3.1？
4. **权衡取舍**: 如何平衡功能完整性和开发周期？

### 技术能力
1. **架构设计**: 7个Phase的重构策略
2. **LLM应用**: Query理解、诊断推理、响应生成
3. **数据建模**: OperationalDetails接口设计（7大类别）
4. **状态管理**: Client/Server组件分离
5. **问题解决**: localStorage缓存导致数据丢失的P0修复

### 项目管理
1. **迭代策略**: 3个迭代（核心能力/智能诊断/上下文记忆）
2. **风险控制**: 保留旧代码作为fallback
3. **质量保证**: 测试文档（COMPLETE_TEST_GUIDE.md等）
4. **文档管理**: 分层文档体系（CONTEXT/VERSION/SNAPSHOT）

---

## 📝 STAR面试话术准备

### Situation（情境）
"在商户智运Agent项目中，AI问答助手收到用户反馈'答非所问、僵化'，无法处理聚合统计和对比分析查询，诊断结果千篇一律。"

### Task（任务）
"我负责重构AI问答助手模块，目标是从规则匹配的Chatbot升级为推理驱动的AI Agent，并增加详细运营数据支持。"

### Action（行动）
"我设计了7个Phase的重构方案：
1. 使用LLM进行查询结构化解析，支持聚合/对比/趋势查询
2. 重构诊断引擎，从规则阈值检测改为因果推理
3. 升级案例匹配，从标签相似度改为语义相似度
4. 废除固定模板，改用LLM动态生成响应
5. 扩展商户数据模型，新增7大类别30+详细运营指标
6. 实现3大数据可视化功能（预警/趋势/对比）
7. 优化AI助手UI，提升可见度200%"

### Result（结果）
"完成后：
- 支持聚合统计、对比分析等复杂查询
- AI诊断从'营收低'升级为'翻台率1.2次/天，低于行业标准'
- 响应从纯文本升级为智能可视化（彩色卡片+图表）
- 新增2000行代码，18次提交，功能完成度100%
- 用户体验显著提升，查询理解准确率>90%"

---

## 🔍 深度讨论方向

### 1. 技术选型
- 为什么选择LLM而非传统NLP？
- 如何平衡LLM成本和效果？
- 为什么用localStorage而非后端数据库？

### 2. 架构设计
- 7个Phase的依赖关系和实施顺序
- Client/Server组件分离的必要性
- 深度合并策略的设计思路

### 3. 数据建模
- 为什么设计7大数据类别？
- 如何处理不同业态的差异化字段？
- 如何确保数据一致性？

### 4. 用户体验
- 如何设计AI助手图标（显眼但不刺眼）？
- 为什么去除Markdown改用可视化？
- 如何平衡信息密度和可读性？

### 5. 项目管理
- 如何控制2天开发周期？
- 如何处理P0 Bug（localStorage缓存问题）？
- 如何确保向后兼容？

---

## 📂 关键文档位置

- **完整版本快照**: `docs/snapshots/v3.1-SNAPSHOT.md`
- **版本历史**: `VERSION.md`
- **项目上下文**: `CONTEXT.md`
- **测试指南**: `COMPLETE_TEST_GUIDE.md`
- **代码位置**:
  - AI诊断引擎: `skills/ai-diagnosis-engine.ts`
  - 响应解析器: `utils/ai-assistant/responseParser.ts`
  - 数据表单: `components/merchants/OperationalDataForm.tsx`
  - 可视化组件: `components/merchants/KeyMetricsAlert.tsx`

---

## 🎤 开场白建议

"我想复盘一下最近完成的AI问答助手Agent重构项目。这个项目的背景是用户反馈系统'答非所问、僵化'，我通过v3.0的7个Phase重构和v3.1的数据扩展，将系统从规则匹配的Chatbot升级为推理驱动的AI Agent。核心亮点是使用LLM进行查询理解和因果推理，并新增30+详细运营指标支持精准诊断。我想和你深度讨论一下技术选型、架构设计、以及如何在简历和面试中呈现这个项目。"

---

**准备完成！切换新窗口后，直接说"开始复盘AI问答助手项目"即可快速切入。** 🚀
