# AI智能问答Agent项目复盘 - 完整方案汇总
## 为简历和面试准备的核心材料

**文档目的**: 汇总两次深度讨论的所有关键结论和方案，便于快速查阅

---

## 📋 文档更新清单

### ✅ 已完成的文档更新

1. **STANDARD-RESUME.md** - 简历更新
   - 在深维智能公司部分增加了"AI智能问答Agent（因果推理诊断）"独立bullet
   - 字数：197字，符合简历bullet长度要求

2. **PROJECT-DETAILED.md** - 项目详细文档更新
   - 在系统1下增加了"1.1 AI智能问答Agent"子模块
   - 包含技术定位、核心问题、技术方案、核心差异、实际案例、价值量化

3. **AI-QA-AGENT-TECH-DEEP-DIVE.md** - 技术深度解析文档（新建）
   - 完整的技术实现细节
   - 三视角价值阐述（产品、技术、业务）
   - 面试话术准备（3个层次）

---

## 🎯 核心结论

### 结论1：技术定位

**你的项目是：因果推理诊断系统（类GraphRAG架构）**

**✅ 你有的GraphRAG特征：**
- 因果推理链（根因vs症状、问题关联链）
- 多跳推理（商户指标→问题标签→根因分析→历史案例）
- 关系感知（商户-指标-问题标签-案例的关联分析）

**❌ 你缺少的GraphRAG特征：**
- 没有显式的知识图谱数据结构（Neo4j、图数据库）
- 没有图遍历算法（BFS/DFS）
- 没有子图构建机制

**推荐表述：**
- ✅ 使用"因果推理诊断"而非"GraphRAG"
- ✅ 强调"多跳推理"、"结构化查询理解"
- ✅ 区别于"传统RAG"和"简单chatbot"

---

### 结论2：简历Bullet Point（最终版本）

```markdown
- **AI智能问答Agent（因果推理诊断）：** 设计LLM驱动的智能问答系统，实现从规则匹配到因果推理的升级，构建"症状识别→关联分析→根因诊断→证据链构建"的推理链路，支持多跳推理（商户指标→问题标签→根因分析→历史案例），通过Prompt工程实现结构化查询理解（自然语言→JSON Schema），支持聚合统计、对比分析、趋势查询等复杂场景，查询理解准确率>90%，诊断从"营收低"升级为"位置劣势（主因，90%置信度）→3层客流比1-2层低40%→翻台率1.2次/天（行业标准3.0次）"，晨会数据准备从2小时降至5分钟（⬇96%）
```

**字数**: 197字
**关键词**: 因果推理、多跳推理、Prompt工程、结构化查询理解、置信度

---

## 🔍 三个核心技术问题的深度解答

### 问题1：结构化查询的Prompt工程怎么做的？

#### 3层Prompt设计

**第1层：任务定义 + 上下文注入**
- 解决follow-up问题（"小龙坎呢？"）
- 注入对话上下文（最近讨论商户、上一轮意图、最近消息）

**第2层：规则定义 + Few-shot示例**
- 4种查询类型（single_merchant, aggregation, comparison, trend_analysis）
- 每种类型提供触发条件和具体示例
- Few-shot Learning比纯指令更准确

**第3层：Schema约束 + 关键约束**
- 明确每个字段的类型和可选值
- 针对LLM常见错误设置关键约束
- 要求严格JSON输出，不要额外文字

**代码位置**: `query-analyzer.ts:229-345`

---

### 问题2：为什么要Schema定义和错误处理机制？

#### Schema定义的3个作用

1. **约束LLM输出格式**：避免返回错误类型（字符串vs数组、枚举值vs自由文本）
2. **提供类型安全**：TypeScript类型定义，后续代码可以安全访问
3. **便于后续处理**：有了Schema，可以安全地访问字段和设置默认值

#### 3层错误处理机制

**第1层：LLM响应解析**
- 处理```json```代码块
- 处理JSON格式错误
- 容错处理，避免系统崩溃

**第2层：规则验证和修正**
- 补全缺失字段（如aggregation查询必须有operation）
- 上下文继承（用户说"它呢？"，从上下文继承商户）
- 修正逻辑错误

**第3层：降级机制**
- LLM不可用时返回保守查询
- 确保系统始终能运行

**代码位置**: `query-analyzer.ts:350-374, 379-399, 68-72`

---

### 问题3：每个根因都有置信度，这个具体怎么做？

#### 2种置信度计算方式

**方式1：LLM直接给出置信度（主要方式）**

Prompt中引导LLM判断：
```
⚠️ 以上数据为**真实采集数据**，请在分析中优先使用，避免基于假设推测。
```

LLM推理逻辑：
- 有真实数据 → 置信度高（90%）
- 数据明确（翻台率1.2 vs 行业标准3.0） → 置信度高
- 只有健康度评分，无详细数据 → 置信度中等（70%）
- 完全推测 → 置信度低（50%）

**方式2：规则验证和修正**
- 限制置信度在0-100范围
- 逻辑一致性检查（健康度<40但评级低 → 修正为high）
- 防止LLM幻觉

#### 置信度的3个来源

| 来源 | 置信度范围 | 示例 |
|------|-----------|------|
| **真实数据证据** | 85-95% | "翻台率1.2次/天（实际采集）vs 行业标准3.0次" |
| **健康度指标推断** | 70-85% | "经营表现35分（低） → 推测营收低" |
| **完全推测** | 50-70% | "无数据，根据业态特点推测可能是产品问题" |

#### 置信度的实际应用

1. **排序根因**：按置信度排序，区分主因vs次因
2. **决定是否展示**：只展示置信度>70%的根因
3. **标注推测性诊断**：置信度<70%标注"（推测，建议进一步核实）"

**代码位置**: `ai-diagnosis-engine.ts:673-798, 803-833`

---

## 🎤 面试话术（3个层次）

### Level 1: 2分钟电梯演讲

"我设计了一个AI智能问答Agent，解决运营人员'看得到数据，分析不出原因'的痛点。核心创新是**因果推理诊断**：不是简单的文档检索，而是通过多跳推理追溯根本原因。比如用户问'海底捞为什么营收低'，系统会进行3跳推理：第1跳提取商户指标，第2跳关联分析发现翻台率1.2次/天远低于行业标准3.0次，第3跳因果推理得出根因是位置劣势（3层客流比1-2层低40%），并给出90%置信度。这让诊断从'营收低'升级为'位置劣势→客流少→翻台率低→营收低'的完整证据链，查询理解准确率>90%，晨会数据准备从2小时降到5分钟。"

---

### Level 2: 10分钟技术深度

**面试官追问："你说的因果推理具体怎么实现的？"**

"我设计了一个3层推理架构：

**第1层：结构化查询理解**
- 用LLM将自然语言转为JSON
- 关键是Prompt工程，我设计了3层Prompt：任务定义+上下文注入、规则定义+Few-shot示例、Schema约束+关键约束
- 还有3层错误处理：LLM响应解析、规则验证修正、降级机制

**第2层：多跳推理**
- Hop 1：提取商户指标（营收、客流、翻台率、位置）
- Hop 2：关联分析（翻台率1.2 vs 行业标准3.0，3层 vs 1-2层客流）
- Hop 3：因果推理（位置劣势 → 客流少 → 翻台率低 → 营收低）

**第3层：证据链构建**
- 每个根因都有置信度（基于数据证据）
- LLM根据数据质量判断：真实数据85-95%，健康度指标推断70-85%，完全推测50-70%
- 规则验证防止LLM幻觉：置信度限制在0-100，逻辑一致性检查

这和传统RAG的区别是：RAG只做向量检索，我做的是因果推理。"

---

### Level 3: 30分钟系统设计

**面试官追问："如果让你用GraphRAG重新设计，你会怎么做？"**

"我会这样设计：

**当前方案（类GraphRAG）：**
- 优势：轻量级，不需要图数据库，开发快
- 劣势：推理深度受限，无法处理复杂的多层因果关系

**GraphRAG升级方案：**
1. **知识图谱构建**：节点（商户、指标、问题标签、根因、案例、解决方案），边（因果关系、对比关系、时序关系、证据关系）
2. **图遍历算法**：使用BFS进行多跳推理，支持更复杂的因果链（5跳以上）
3. **子图构建**：根据查询动态提取相关子图，在子图上进行推理

**权衡取舍：**
- 当前阶段：MVP验证，类GraphRAG足够
- 未来规划：如果商户数>1000，案例数>10000，再升级到GraphRAG

这展示了我的架构演进思维：先用轻量级方案验证，再根据业务规模升级。"

---

## 📊 三视角价值阐述

### 1. 产品视角：Dashboard vs AI问答

| 维度 | Dashboard（旧） | AI问答Agent（新） | 根本性区别 |
|------|----------------|------------------|-----------|
| **交互方式** | 被动查看固定报表 | 主动提问，自然语言交互 | 从"看数据"到"问问题" |
| **信息获取** | 需要翻页、筛选、点击 | 一句话直达答案 | 效率提升10倍 |
| **诊断深度** | 只展示指标异常 | 追溯根本原因+证据链 | 从"是什么"到"为什么" |
| **决策支持** | 需要人工分析判断 | AI给出诊断+推荐措施 | 从"数据展示"到"决策建议" |
| **学习成本** | 需要培训，记住在哪个页面 | 零学习成本，像聊天一样 | 用户体验质的飞跃 |

---

### 2. 技术视角：因果推理 vs 传统RAG

| 技术点 | 传统RAG | 因果推理方案 |
|--------|---------|-------------|
| **查询理解** | 关键词匹配 | LLM结构化解析（自然语言→JSON） |
| **检索方式** | 向量相似度 | 多维度关联分析（业态+标签+症状+指标） |
| **推理深度** | 单次检索 | 多跳推理（3跳：指标→关联→根因） |
| **诊断逻辑** | 案例相似度 | 因果链推理（A→B→C） |
| **置信度** | 无 | 基于数据证据的置信度计算 |
| **输出** | 相似案例 | 根因+证据链+置信度 |

---

### 3. 业务视角：4大痛点解决

| 痛点 | 现状 | AI问答解决方案 | 价值 |
|------|------|---------------|------|
| **运营人员不会用Dashboard** | 20+页面，不知道去哪找数据 | 自然语言交互，零学习成本 | 使用率⬆ |
| **数据看得到，原因分析不出来** | 需要30分钟人工分析 | AI自动因果推理，3秒给出根因+证据 | 效率⬆600倍 |
| **晨会数据准备耗时长** | 每天2小时整理数据 | 一句话查询，5分钟完成 | 时间⬇96% |
| **决策依赖经验，缺乏数据支撑** | 凭经验判断，主观性强 | AI给出数据证据 | 准确率⬆50% |

---

## 📈 量化成果汇总

| 指标 | 改进前 | 改进后 | 提升幅度 |
|------|--------|--------|---------|
| **查询理解准确率** | 60% | >90% | ⬆50% |
| **晨会数据准备时间** | 2小时 | 5分钟 | ⬇96% |
| **诊断深度** | "营收低"（症状） | "位置劣势→客流少→翻台率低→营收低"（根因+证据链） | 质的飞跃 |
| **决策效率** | 30分钟人工分析 | 3秒AI诊断 | ⬆600倍 |
| **用户满意度** | "答非所问"投诉 | "精准诊断"好评 | 质的飞跃 |

---

## 🔗 关键代码位置

| 功能模块 | 文件路径 | 关键函数 |
|---------|---------|---------|
| **结构化查询理解** | `skills/ai-assistant/query-analyzer.ts` | `analyze()`, `buildAnalysisPrompt()` |
| **因果推理诊断** | `skills/ai-diagnosis-engine.ts` | `generateEnhancedDiagnosisReport()`, `analyzeCausalRelations()` |
| **错误处理** | `skills/ai-assistant/query-analyzer.ts` | `parseLLMResponse()`, `validateAndFix()` |
| **置信度计算** | `skills/ai-diagnosis-engine.ts` | `validateDiagnosisWithRules()` |

---

## ✅ 核心竞争力总结

1. **Prompt工程能力**：3层Prompt设计（任务定义+Few-shot+Schema约束），查询理解准确率>90%
2. **工程化思维**：3层错误处理机制（解析+验证+降级），确保系统鲁棒性
3. **AI应用深度**：因果推理+多跳推理+置信度计算，不是简单调用LLM API
4. **产品思维**：从用户痛点出发（Dashboard局限性），设计AI问答解决方案
5. **架构演进思维**：当前类GraphRAG方案 → 未来GraphRAG升级路径

---

## 📚 相关文档索引

1. **STANDARD-RESUME.md** - 简历（已更新AI智能问答Agent bullet）
2. **PROJECT-DETAILED.md** - 项目详细文档（已更新系统1.1 AI智能问答Agent）
3. **AI-QA-AGENT-TECH-DEEP-DIVE.md** - 技术深度解析（新建，完整技术细节）
4. **AI-ASSISTANT-PROJECT-REVIEW-PREP.md** - v3.0+v3.1项目复盘准备（原有文档）
5. **INTERVIEW-QA.md** - 30个面试问题（原有文档）

---

## 🎯 面试准备检查清单

### 必须准备的内容

- [ ] 2分钟电梯演讲（背熟）
- [ ] 3个核心技术问题的深度解答（Prompt工程、Schema+错误处理、置信度计算）
- [ ] Dashboard vs AI问答的对比（产品视角）
- [ ] 因果推理 vs 传统RAG的对比（技术视角）
- [ ] 4大业务痛点和解决方案（业务视角）
- [ ] 量化成果数据（查询准确率>90%，晨会时间⬇96%，决策效率⬆600倍）

### 可能被追问的问题

- [ ] "为什么不用GraphRAG？" → 准备架构演进思路
- [ ] "如何防止LLM幻觉？" → 准备3层错误处理机制
- [ ] "置信度如何计算？" → 准备2种方式（LLM判断+规则验证）
- [ ] "如何优化Prompt？" → 准备3层Prompt设计
- [ ] "如何处理follow-up问题？" → 准备上下文注入机制

### 代码示例准备

- [ ] 准备query-analyzer.ts的关键代码片段
- [ ] 准备ai-diagnosis-engine.ts的关键代码片段
- [ ] 准备Prompt示例（buildAnalysisPrompt）
- [ ] 准备Schema定义示例（StructuredQuery接口）

---

**文档版本**: v1.0
**最后更新**: 2026-02-11
**作者**: 何雨轩
**用途**: 简历和面试准备的核心参考材料
