# 批量巡检模式功能说明

## 📋 功能概述

批量巡检模式是为提升巡检效率而设计的专业工具，解决了传统单商户巡检模式下的效率瓶颈问题。

### 核心优势
- **效率提升 50%+**: 15家商户从75分钟降至约40分钟
- **无缝切换**: 商户间快速跳转，无需重新加载页面
- **自动保存**: 草稿实时保存，防止数据丢失
- **进度可视化**: 实时展示巡检进度和完成状态

---

## 🚀 访问方式

访问路径: `http://localhost:3000/inspection/batch`

或从巡检首页点击"批量巡检模式"入口（如已添加）

---

## 💡 核心功能

### 1. 商户列表快速切换

**侧边栏商户列表**:
- 显示所有商户及其巡检状态
- 支持点击任意商户快速跳转
- 三种状态标识:
  - ✅ **已完成**: 绿色对勾，巡检已保存
  - ⚠️ **草稿**: 橙色警告，有未保存的草稿
  - ⭕ **未开始**: 灰色圆圈，待巡检

**快捷导航按钮**:
- 上一家 / 下一家按钮快速切换
- 完成巡检后自动跳转至下一家未完成商户

### 2. 草稿自动保存

**自动保存机制**:
- 切换商户时自动保存当前草稿
- 包含签到、评分、照片、语音、备注等全部内容
- 草稿独立存储，互不干扰

**手动保存**:
- 点击"保存草稿"按钮手动保存
- 草稿在商户列表中显示橙色标识

**自动恢复**:
- 切换回有草稿的商户时自动加载
- 无缝续接之前的工作

### 3. 进度追踪

**顶部进度统计**:
- 当前位置: "3/15"
- 进度条: 可视化展示完成百分比
- 完成数量: "已完成 5/15"

**侧边栏详细统计**:
- 已完成: 绿色数字
- 草稿: 橙色数字
- 待巡检: 灰色数字

### 4. 完整巡检功能

与单商户模式相同的功能:
- GPS签到 + 商户画像
- 5维度快速评分
- 人货场拍照分类
- 语音笔记 + 文字备注
- AI反馈生成

---

## 📱 使用流程

### 典型工作流

```
1. 打开批量巡检页面
   ↓
2. 开始第一家商户巡检
   - 签到
   - 拍照
   - 评分
   - 备注
   ↓
3. 点击"完成巡检"
   ↓
4. 查看AI反馈
   ↓
5. 自动跳转到下一家商户
   ↓
6. 重复步骤 2-5
   ↓
7. 完成所有商户巡检
```

### 中断恢复流程

```
1. 正在巡检第3家商户（已填写部分内容）
   ↓
2. 点击"保存草稿"或切换商户（自动保存）
   ↓
3. 关闭页面/浏览器
   ↓
4. 稍后重新打开批量巡检页面
   ↓
5. 在商户列表中找到第3家商户（橙色"草稿"标识）
   ↓
6. 点击切换，自动恢复之前填写的内容
   ↓
7. 继续完成巡检
```

---

## 🎯 使用场景

### 场景1: 早高峰连续巡检
**背景**: 运营经理早上8:00-10:00需要巡检15家早餐商户

**使用批量模式**:
- 按楼层顺序巡检
- 每家商户2-3分钟
- 总耗时约40分钟
- 效率提升 47%

### 场景2: 专项检查
**背景**: 安全专员需要检查所有餐饮商户的消防设施

**使用批量模式**:
- 筛选餐饮业态商户
- 重点拍照消防通道、灭火器
- 快速评分安全维度
- 批量生成检查报告

### 场景3: 断点续传
**背景**: 巡检进行到一半突然有紧急任务

**使用批量模式**:
- 当前商户自动保存草稿
- 处理完紧急任务后继续
- 所有数据完整保留
- 无需重复工作

---

## 💾 数据存储

### 草稿存储
- **存储位置**: localStorage
- **存储键**: `batch_inspection_drafts`
- **数据结构**:
  ```json
  {
    "M001": {
      "merchantId": "M001",
      "photos": [...],
      "audioNote": {...},
      "checkIn": {...},
      "rating": {...},
      "textNotes": "...",
      "lastSaved": "2026-01-29T10:30:00Z"
    },
    "M002": {...}
  }
  ```

### 巡检状态
- **存储位置**: localStorage
- **存储键**: `batch_inspection_status`
- **数据结构**:
  ```json
  [
    {
      "merchantId": "M001",
      "completed": true,
      "hasDraft": false
    },
    {
      "merchantId": "M002",
      "completed": false,
      "hasDraft": true
    }
  ]
  ```

### 正式记录
- **存储位置**: localStorage
- **存储键**: `inspection_records` (与单商户模式共享)
- 完成巡检后保存，与单商户模式数据格式一致

---

## 🔧 技术实现

### 核心功能模块

1. **商户管理**
   - `merchantDataManager.getAllMerchants()` - 获取商户列表
   - `merchantDataManager.onMerchantsChange()` - 监听数据变化

2. **草稿管理**
   - `loadDraft(merchantId)` - 加载草稿
   - `saveDraft(merchantId)` - 保存草稿
   - `clearDraft(merchantId)` - 清除草稿

3. **状态管理**
   - `loadInspectionStatus()` - 加载巡检状态
   - `saveInspectionStatus(status)` - 保存巡检状态

4. **商户切换**
   - `switchToMerchant(index)` - 切换商户
   - 自动保存当前草稿 → 切换索引 → 加载新草稿

5. **保存流程**
   - `handleSaveInspection()` - 保存巡检记录
   - 更新巡检状态为已完成
   - 清除草稿
   - 显示AI反馈
   - 自动跳转下一家

---

## 📊 效率对比

### 传统单商户模式
```
每家商户耗时: 约5分钟
- 打开页面 (30秒)
- 商户画像加载 (5秒)
- 拍照分类标注 (2.5分钟)
- 评分 (1分钟)
- 填写备注 (30秒)
- 保存等待 (10秒)

15家商户总耗时: 75分钟
```

### 批量巡检模式
```
每家商户耗时: 约2.5分钟
- 快速切换 (即时)
- 商户画像复用 (缓存)
- 拍照分类标注 (1.5分钟)
- 评分 (0.5分钟)
- 填写备注 (30秒)
- 一键保存 (即时)

15家商户总耗时: 约40分钟
```

**效率提升**: -47% (节省35分钟)

---

## ⚠️ 注意事项

1. **数据同步**
   - 草稿保存在浏览器本地
   - 清除浏览器缓存会丢失草稿（正式记录不受影响）
   - 建议定期完成巡检，避免草稿积压

2. **商户切换**
   - 切换商户时会自动保存草稿
   - 建议切换前完成当前商户巡检（更高效）

3. **浏览器兼容性**
   - 需要支持 localStorage 的现代浏览器
   - 建议使用 Chrome/Safari/Edge 最新版

4. **存储空间**
   - 草稿会占用浏览器存储空间
   - 建议完成巡检后定期清理草稿

---

## 🚀 未来优化方向

### P1 优化 (下个迭代)
- [ ] 智能拍照分类建议（启发式规则）
- [ ] 批量操作模板（正常/问题/严重）
- [ ] 语音转评分功能集成

### P2 优化
- [ ] IndexedDB迁移（突破localStorage容量限制）
- [ ] 离线模式支持（Service Worker）
- [ ] 批量导出报告（PDF/Excel）

### P3 优化
- [ ] 协同巡检（多人同时巡检）
- [ ] 语音助手模式
- [ ] AR增强巡检

---

## 📞 问题反馈

如遇到问题或有优化建议，请联系开发团队。

---

**版本**: v1.0
**最后更新**: 2026-01-29
**维护人**: Mall Operation System Team
