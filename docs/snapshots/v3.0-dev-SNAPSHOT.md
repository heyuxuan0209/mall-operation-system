# å•†æˆ·æ™ºè¿Agent v3.0-dev ç‰ˆæœ¬å¿«ç…§
# Merchant SmartOps AI Agent v3.0-dev Snapshot

**åˆ›å»ºæ—¶é—´**: 2026-02-07
**ç‰ˆæœ¬çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­ - AIé—®ç­”åŠ©æ‰‹ç³»ç»Ÿæ€§é‡æ„
**Git Commit**: TBDï¼ˆè§„åˆ’é˜¶æ®µï¼‰

---

## ğŸ“‹ ç‰ˆæœ¬æ¦‚è¿°

### ç‰ˆæœ¬ä¸»é¢˜
**ä»"è§„åˆ™åŒ¹é…çš„Chatbot"å‡çº§ä¸º"æ¨ç†é©±åŠ¨çš„AI Agent"**

### é‡æ„èŒƒå›´
âš ï¸ **ä»…é‡æ„AIé—®ç­”åŠ©æ‰‹æ¨¡å—**
âœ… **å…¶ä»–åŠŸèƒ½ä¿æŒç°æœ‰é€»è¾‘ä¸å˜**:
- Dashboardï¼ˆç®¡ç†é©¾é©¶èˆ±ï¼‰
- Inspectionï¼ˆç°åœºå·¡åº—/æ‰¹é‡å·¡æ£€ï¼‰
- Tasksï¼ˆä»»åŠ¡ç®¡ç†ï¼‰
- Knowledgeï¼ˆçŸ¥è¯†åº“ï¼‰
- Health Monitoringï¼ˆå¥åº·åº¦ç›‘æ§ï¼‰
- History Archiveï¼ˆå†å²å¸®æ‰¶æ¡£æ¡ˆï¼‰

---

## ğŸ¯ é‡æ„èƒŒæ™¯

### ç”¨æˆ·åé¦ˆï¼š"ç­”éæ‰€é—®ã€åƒµåŒ–"

**å…·ä½“é—®é¢˜æ¡ˆä¾‹**:

1. **é—®é¢˜1**: "æµ·åº•ææœ€è¿‘å¦‚ä½•"
   - ç°çŠ¶: è¿”å›å›ºå®šå¥åº·åº¦æŠ¥å‘Š
   - é—®é¢˜: ç”¨æˆ·å¯èƒ½æƒ³è¦è¶‹åŠ¿å¯¹æ¯”ã€ä¸ä¸Šæœˆå¯¹æ¯”ã€ä¸åŒè¡Œå¯¹æ¯”
   - æ ¹å› : Responseå®Œå…¨æ¨¡æ¿åŒ–

2. **é—®é¢˜2**: "å°é¾™åå‘¢"
   - ç°çŠ¶: è¿”å›é€šç”¨å›å¤
   - é—®é¢˜: åº”è¯¥ç†è§£ä¸Šä¸‹æ–‡å¼•ç”¨ï¼ˆä¸Šä¸€è½®æåˆ°äº†æµ·åº•æï¼‰
   - æ ¹å› : ç¼ºä¹å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†

3. **é—®é¢˜3**: "è¿™ä¸ªæœˆå•†æˆ·é£é™©å¦‚ä½•ï¼Ÿå¤šå°‘é«˜é£é™©ï¼Œå’Œä¸Šä¸ªæœˆæ¯”æ€ä¹ˆæ ·ï¼Ÿ"
   - ç°çŠ¶: åªè¿”å›å•ä¸ªå•†æˆ·ï¼ˆæµ·åº•æï¼‰çš„é£é™©
   - é—®é¢˜: åº”è¯¥è¿”å›èšåˆç»Ÿè®¡ + å¯¹æ¯”åˆ†æ
   - æ ¹å› : ç¡¬ç¼–ç çš„å•å•†æˆ·å‡è®¾

4. **é—®é¢˜4**: "æ€ä¹ˆå¸®æ‰¶æµ·åº•æ"
   - ç°çŠ¶: åªè¿”å›"æµ·åº•æç«é”… å¸®æ‰¶æ–¹æ¡ˆ"æ ‡é¢˜
   - é—®é¢˜: åº”è¯¥ä¸ªæ€§åŒ–ç”Ÿæˆå…·ä½“æªæ–½
   - æ ¹å› : è§„åˆ™é©±åŠ¨çš„è¯Šæ–­å¼•æ“

### æ ¹æœ¬é—®é¢˜è¯Šæ–­

#### é—®é¢˜1: ç¡¬ç¼–ç çš„å•å•†æˆ·å‡è®¾ï¼ˆè‡´å‘½ï¼‰
**ç°çŠ¶**: æ•´ä¸ªç³»ç»Ÿä»Intentåˆ°Responseéƒ½å‡è®¾ç”¨æˆ·åœ¨æŸ¥è¯¢"æŸä¸€ä¸ªç‰¹å®šå•†æˆ·"

```
ç”¨æˆ·é—®ï¼š"è¿™ä¸ªæœˆå•†æˆ·é£é™©å¦‚ä½•ï¼Ÿå¤šå°‘é«˜é£é™©ï¼Œå’Œä¸Šä¸ªæœˆæ¯”æ€ä¹ˆæ ·ï¼Ÿ"
ç³»ç»Ÿç†è§£ï¼šæŸ¥è¯¢"æµ·åº•æ"çš„é£é™©ï¼ˆåªå› ä¸ºä¸Šä¸€è½®æåˆ°äº†æµ·åº•æï¼‰
å®é™…éœ€æ±‚ï¼šæŸ¥è¯¢"æ‰€æœ‰å•†æˆ·"çš„ç»Ÿè®¡æ•°æ®å’Œè¶‹åŠ¿å¯¹æ¯”

ç»“æœï¼šå®Œå…¨ç­”éæ‰€é—®
```

**æ ¹æº**ï¼š
- `types/ai-assistant.ts` ç¬¬9-15è¡Œï¼šIntentå®šä¹‰ä¸­æ²¡æœ‰èšåˆ/ç»Ÿè®¡/å¯¹æ¯”ç±»å‹
- `agent-router.ts` ç¬¬85-92è¡Œï¼šæ²¡æœ‰å•†æˆ·IDå°±è¿”å›å¤±è´¥ï¼Œæ— é™çº§è·¯å¾„
- `response-generator.ts` ç¬¬14-285è¡Œï¼šæ‰€æœ‰ç”Ÿæˆå‡½æ•°ç¬¬ä¸€å‚æ•°éƒ½æ˜¯ `merchant: Merchant`

#### é—®é¢˜2: è§„åˆ™é©±åŠ¨çš„è¯Šæ–­å¼•æ“ï¼ˆä¸¥é‡ï¼‰
**ç”¨æˆ·æ ¸å¿ƒè¯‰æ±‚**: "æ¯ä¸ªå•†æˆ·æƒ…å†µä¸åŒï¼ŒåŒæ ·æ˜¯'è¥æ”¶ä¸‹æ»‘'ï¼ŒåŸå› å’Œæªæ–½å®Œå…¨ä¸åŒ"

**ç°çŠ¶**:
```typescript
// ai-diagnosis-engine.ts å½“å‰é€»è¾‘
if (metrics.operational < 60) {
  problems.push('ä¸šç»©ä¸‹æ»‘');
  tags.push('è¥æ”¶ä½', 'å®¢æµå°‘');  // âŒ ç¬¼ç»Ÿæ ‡ç­¾
}

// æ¡ˆä¾‹åŒ¹é…ï¼šåªçœ‹æ ‡ç­¾ç›¸åŒ
matchScore = ä¸šæ€åŒ¹é… + æ ‡ç­¾åŒ¹é…
```

**é—®é¢˜**:
- æ— æ³•åŒºåˆ†"è¥æ”¶ä¸‹æ»‘"çš„æ ¹æœ¬åŸå› ï¼ˆä½ç½®å·® vs ç®¡ç†å·® vs äº§å“å·®ï¼‰
- ç«é”…"ç¼ºå®¢æµ" vs æœé¥°"ç¼ºå®¢æµ" ä¼šåŒ¹é…åˆ°ç›¸åŒæ¡ˆä¾‹ï¼Œä½†è§£å†³æ–¹æ¡ˆå®Œå…¨ä¸åŒ
- LLMæœ‰æ¨ç†èƒ½åŠ›ä½†æœªç”¨äºè¯Šæ–­ï¼Œåªç”¨äºç”Ÿæˆæ–‡æœ¬

#### é—®é¢˜3: Intentè¯†åˆ«å¤ªç²—ç³™ï¼ˆé«˜ï¼‰
**ç°çŠ¶**: å…³é”®è¯æƒé‡åŒ¹é…å¯¼è‡´æ„å›¾æ··æ·†

```
"æµ·åº•ææœ€è¿‘å¦‚ä½•" â†’ åŒ¹é… health_queryï¼ˆ"å¦‚ä½•"æƒé‡12ï¼‰
                  â†’ ä½†ä¹ŸåŒ¹é… solution_recommendï¼ˆ"å¦‚ä½•"æƒé‡10ï¼‰

"è¿™ä¸ªæœˆå•†æˆ·é£é™©å¦‚ä½•ï¼Ÿå¤šå°‘é«˜é£é™©"
  â†’ health_queryå¾—åˆ†ï¼š12ï¼ˆå¦‚ä½•ï¼‰+ 6ï¼ˆæœ€è¿‘ï¼‰= 18 * 3 = 54
  â†’ data_queryå¾—åˆ†ï¼š8ï¼ˆå¤šå°‘ï¼‰* 1 = 8
  â†’ æ°¸è¿œé€‰æ‹©health_query âŒ
```

#### é—®é¢˜4: Responseå®Œå…¨æ¨¡æ¿åŒ–ï¼ˆé«˜ï¼‰
```typescript
generateHealthQueryResponse() {
  return `# å¥åº·åº¦æŠ¥å‘Š\nğŸ“Š æ€»ä½“è¯„åˆ†\n...`;  // æ°¸è¿œè¿™ä¸ªæ ¼å¼
}
```

ç”¨æˆ·é—®"æœ€è¿‘æ€ä¹ˆæ ·"å¯èƒ½æƒ³è¦ï¼š
- ä¸ä¸Šæœˆå¯¹æ¯” â†’ ç³»ç»Ÿåªè¿”å›å½“å‰å€¼
- è¶‹åŠ¿é¢„åˆ¤ â†’ ç³»ç»Ÿåªè¿”å›å†å²è¶‹åŠ¿
- å¯¹æ ‡åŒè¡Œ â†’ ç³»ç»Ÿå®Œå…¨ä¸æ”¯æŒ

### ä¸šåŠ¡åœºæ™¯ç†è§£

è¿™æ˜¯ä¸€ä¸ª**é«˜é¢‘é‡å¤çš„workflowäº§å“**ï¼š

```
é—®é¢˜å‘ç° â†’ è¯Šæ–­æ ¹å›  â†’ ç»™å‡ºå¸®æ‰¶å»ºè®® â†’ å·¡æ£€æ‰§è¡Œ â†’ æ•ˆæœè¯„ä¼° â†’ æ²‰æ·€çŸ¥è¯†åº“
    â†“          â†“           â†“            â†“          â†“           â†“
  è‡ªåŠ¨åŒ–     AIæ¨ç†    ä¸ªæ€§åŒ–æ–¹æ¡ˆ    äººå·¥ä»‹å…¥    æ•°æ®å¯¹æ¯”    è‡ªåŠ¨å­¦ä¹ 
```

**å¤æ‚æ€§**ï¼š
- æ¯ä¸ªå•†æˆ·çš„èƒŒæ™¯ä¸åŒï¼ˆä¸šæ€ã€ä½ç½®ã€å®¢ç¾¤ã€å†å²ï¼‰
- åŒæ ·é—®é¢˜çš„åŸå› åƒå·®ä¸‡åˆ«ï¼ˆéœ€è¦ä¸Šä¸‹æ–‡+å†å²ç»éªŒåˆ¤æ–­ï¼‰
- è§£å†³æ–¹æ¡ˆéœ€è¦å› åœ°åˆ¶å®œï¼ˆä¸èƒ½å¥—æ¨¡æ¿ï¼‰

**å½“å‰ç³»ç»Ÿç¼ºå¤±**ï¼š
- âŒ æ— èšåˆç»Ÿè®¡èƒ½åŠ›ï¼ˆ"å¤šå°‘ä¸ªé«˜é£é™©å•†æˆ·"ï¼‰
- âŒ æ— å¯¹æ¯”åˆ†æèƒ½åŠ›ï¼ˆ"å’Œä¸Šæœˆæ¯”"ã€"vsåŒç±»å•†æˆ·"ï¼‰
- âŒ æ— æ ¹å› æ¨ç†èƒ½åŠ›ï¼ˆåªèƒ½æ£€æµ‹é—®é¢˜ï¼Œä¸èƒ½åˆ†æåŸå› ï¼‰
- âŒ æ— ä¸ªæ€§åŒ–ç”Ÿæˆèƒ½åŠ›ï¼ˆResponseéƒ½æ˜¯å›ºå®šæ¨¡æ¿ï¼‰

---

## ğŸš€ ç³»ç»Ÿæ€§é‡æ„æ–¹æ¡ˆ

### æ¶æ„ç†å¿µè½¬å˜

**ä»"è§„åˆ™åŒ¹é…çš„Chatbot" â†’ "æ¨ç†é©±åŠ¨çš„AI Agent"**

| ç»´åº¦ | æ—§æ¶æ„ | æ–°æ¶æ„ |
|------|--------|--------|
| **Queryç†è§£** | å…³é”®è¯åŒ¹é… | LLMè¯­ä¹‰ç†è§£ + ç»“æ„åŒ–è§£æ |
| **Intentè¯†åˆ«** | å›ºå®š5ç§å•å•†æˆ·æ„å›¾ | åŠ¨æ€æ„å›¾åˆ†ç±» + å¤åˆæ„å›¾åˆ†è§£ |
| **è¯Šæ–­æ–¹å¼** | è§„åˆ™é˜ˆå€¼æ£€æµ‹ | LLMå› æœæ¨ç† + çŸ¥è¯†åº“éªŒè¯ |
| **æ¡ˆä¾‹åŒ¹é…** | æ ‡ç­¾ç›¸ä¼¼åº¦ | è¯­ä¹‰ç›¸ä¼¼åº¦ + æ ¹å› åŒ¹é… |
| **Responseç”Ÿæˆ** | ç¡¬ç¼–ç æ¨¡æ¿ | åŠ¨æ€ç”Ÿæˆ + ä¸ªæ€§åŒ–è°ƒæ•´ |
| **æ•°æ®èŒƒå›´** | å•å•†æˆ· | å•å•†æˆ· + èšåˆç»Ÿè®¡ + å¯¹æ¯”åˆ†æ |

---

## ğŸ“ Phase 1: Query Understanding å¢å¼º

### 1.1 Query Analyzer - æŸ¥è¯¢ç»“æ„åŒ–è§£æ

**æ–°å»º**: `skills/ai-assistant/query-analyzer.ts`

**ç›®æ ‡**: å°†è‡ªç„¶è¯­è¨€è½¬ä¸ºç»“æ„åŒ–æŸ¥è¯¢

#### æ•°æ®ç»“æ„
```typescript
interface StructuredQuery {
  type: 'single_merchant' | 'aggregation' | 'comparison' | 'trend_analysis';
  entities: {
    merchants?: string[];      // ["æµ·åº•æ"] or ["all"]
    timeRange?: TimeRange;     // "è¿™ä¸ªæœˆ"ã€"æœ€è¿‘"
    comparisonTarget?: string; // "ä¸Šä¸ªæœˆ"ã€"åŒç±»å•†æˆ·"
  };
  intents: Intent[];          // å¯èƒ½åŒ…å«å¤šä¸ªå­æ„å›¾
  filters?: {
    riskLevel?: string[];      // ["high", "critical"]
    category?: string[];       // ["é¤é¥®"]
    metric?: string[];         // ["revenue", "health"]
  };
  aggregations?: {
    operation: 'count' | 'sum' | 'avg' | 'max' | 'min';
    groupBy?: string;          // "category"ã€"riskLevel"
  };
}
```

#### æ ¸å¿ƒæ–¹æ³•
```typescript
class QueryAnalyzer {
  async analyze(userInput: string, context: ConversationContext): Promise<StructuredQuery> {
    // ä½¿ç”¨LLMè¿›è¡Œç»“æ„åŒ–è§£æ
    const prompt = `
      å°†ç”¨æˆ·æŸ¥è¯¢è½¬ä¸ºç»“æ„åŒ–æ ¼å¼ï¼š
      ç”¨æˆ·è¾“å…¥ï¼š"${userInput}"
      å¯¹è¯ä¸Šä¸‹æ–‡ï¼š
      - æœ€è¿‘è®¨è®ºå•†æˆ·ï¼š${context.merchantName || 'æ— '}
      - ä¸Šä¸€è½®æ„å›¾ï¼š${context.lastIntent || 'æ— '}

      è¯·åˆ†æå¹¶è¾“å‡ºJSON
    `;

    const result = await llmIntegration.chat(prompt);
    return JSON.parse(result);
  }
}
```

#### ç¤ºä¾‹
```
è¾“å…¥: "è¿™ä¸ªæœˆå¤šå°‘é«˜é£é™©å•†æˆ·ï¼Œå’Œä¸Šä¸ªæœˆæ¯”æ€ä¹ˆæ ·"
è¾“å‡º: {
  "type": "aggregation",
  "entities": {
    "merchants": ["all"],
    "timeRange": {"period": "current_month"},
    "comparisonTarget": "last_month"
  },
  "intents": ["risk_statistics", "trend_comparison"],
  "filters": {"riskLevel": ["high", "critical"]},
  "aggregations": {"operation": "count", "groupBy": "riskLevel"}
}
```

---

## ğŸ“ Phase 2: Intent System é‡æ„

### 2.1 æ‰©å±•Intentå®šä¹‰

**ä¿®æ”¹**: `types/ai-assistant.ts` ç¬¬9-15è¡Œ

```typescript
export type UserIntent =
  // å•å•†æˆ·æŸ¥è¯¢
  | 'health_query'           // å¥åº·åº¦æŸ¥è¯¢
  | 'risk_diagnosis'         // é£é™©è¯Šæ–­
  | 'solution_recommend'     // æ–¹æ¡ˆæ¨è
  | 'data_query'            // æ•°æ®æŸ¥è¯¢

  // ğŸ”¥ æ–°å¢ï¼šèšåˆç»Ÿè®¡
  | 'aggregation_query'      // "å¤šå°‘ä¸ªé«˜é£é™©å•†æˆ·"
  | 'risk_statistics'        // "é£é™©ç»Ÿè®¡"
  | 'health_overview'        // "æ•´ä½“å¥åº·åº¦"

  // ğŸ”¥ æ–°å¢ï¼šå¯¹æ¯”åˆ†æ
  | 'comparison_query'       // "vsä¸Šæœˆ"ã€"vsåŒç±»"
  | 'trend_analysis'         // "è¶‹åŠ¿åˆ†æ"

  // ğŸ”¥ æ–°å¢ï¼šå¤åˆæŸ¥è¯¢
  | 'composite_query'        // åŒ…å«å¤šä¸ªå­æ„å›¾

  | 'general_chat'
  | 'unknown';
```

### 2.2 Intent Classifier å‡çº§

**ä¿®æ”¹**: `skills/ai-assistant/intent-classifier.ts`

#### æ”¹è¿›ç‚¹
1. **åºŸé™¤çº¯å…³é”®è¯åŒ¹é…**ï¼šæ”¹ç”¨LLMè¿›è¡Œè¯­ä¹‰åˆ†ç±»
2. **æ”¯æŒå¤šæ„å›¾è¯†åˆ«**ï¼šä¸€å¥è¯å¯èƒ½åŒ…å«å¤šä¸ªæ„å›¾
3. **åŠ¨æ€è°ƒæ•´ç½®ä¿¡åº¦**ï¼šæ ¹æ®ä¸Šä¸‹æ–‡å’ŒæŸ¥è¯¢å¤æ‚åº¦

#### æ ¸å¿ƒæ–¹æ³•
```typescript
class IntentClassifier {
  async classifyWithLLM(
    structuredQuery: StructuredQuery,
    context: ConversationContext
  ): Promise<IntentResult[]> {
    const prompt = `
      åŸºäºç»“æ„åŒ–æŸ¥è¯¢å’Œå¯¹è¯ä¸Šä¸‹æ–‡ï¼Œè¯†åˆ«ç”¨æˆ·æ„å›¾ï¼š
      æŸ¥è¯¢ç±»å‹ï¼š${structuredQuery.type}
      æŸ¥è¯¢å†…å®¹ï¼š${JSON.stringify(structuredQuery)}

      è¾“å‡ºæ ¼å¼ï¼š
      [
        {"intent": "...", "confidence": 0.9, "reason": "..."},
        {"intent": "...", "confidence": 0.7, "reason": "..."}
      ]
    `;

    const result = await llmIntegration.chat(prompt);
    return JSON.parse(result);
  }
}
```

---

## ğŸ“ Phase 3: è¯Šæ–­å¼•æ“ - ä»è§„åˆ™åˆ°æ¨ç†

### 3.1 AI-Powered Diagnosis Engine

**ä¿®æ”¹**: `skills/ai-diagnosis-engine.ts`

#### æ ¸å¿ƒæ”¹è¿›: LLMé©±åŠ¨çš„å› æœæ¨ç† + è§„åˆ™éªŒè¯

```typescript
class AIDiagnosisEngine {
  async diagnose(merchant: Merchant, context: BusinessContext): Promise<DiagnosisReport> {
    // æ­¥éª¤1: æ”¶é›†è¯Šæ–­ä¸Šä¸‹æ–‡
    const diagnosticContext = {
      merchant: {
        name: merchant.name,
        category: merchant.category,
        metrics: merchant.metrics,
        trends: await getTrends(merchant.id),
      },
      businessContext: {
        mallFootTraffic: context.mallFootTraffic,
        competitors: context.competitors,
        seasonality: context.seasonality,
      },
      historicalData: {
        pastPerformance: await getHistoricalMetrics(merchant.id, '6m'),
        previousIssues: await getPreviousIssues(merchant.id),
      },
    };

    // æ­¥éª¤2: LLMè¿›è¡Œæ ¹å› åˆ†æ
    const rootCausePrompt = `
      ä½ æ˜¯èµ„æ·±çš„å•†åœºè¿è¥é¡¾é—®ï¼Œæ“…é•¿è¯Šæ–­å•†æˆ·ç»è¥é—®é¢˜ã€‚

      # å•†æˆ·ä¿¡æ¯
      åç§°ï¼š${merchant.name}
      ä¸šæ€ï¼š${merchant.category}
      ä½ç½®ï¼š${merchant.location}

      # ç»è¥æŒ‡æ ‡
      ${this.formatMetrics(merchant.metrics)}

      # è¶‹åŠ¿å˜åŒ–
      ${this.formatTrends(diagnosticContext.merchant.trends)}

      è¯·æ·±åº¦åˆ†æï¼š
      1. ç—‡çŠ¶è¯†åˆ«ï¼ˆå…·ä½“é—®é¢˜ï¼‰
      2. æ ¹å› æ¨ç†ï¼ˆå†…å› /å¤–å› ï¼Œç»“æ„æ€§/æš‚æ—¶æ€§ï¼‰
      3. ä¸¥é‡ç¨‹åº¦ï¼ˆç´§æ€¥åº¦+é‡è¦åº¦ï¼‰
      4. å¯è¡Œæ€§é¢„åˆ¤

      è¾“å‡ºJSONæ ¼å¼ï¼š
      {
        "symptoms": ["å…·ä½“ç—‡çŠ¶"],
        "rootCauses": [{
          "cause": "æ ¹æœ¬åŸå› ",
          "type": "internal|external|structural",
          "evidence": ["æ”¯æŒè¯æ®"],
          "confidence": 0.0-1.0
        }],
        "problemChain": "é—®é¢˜Aå¯¼è‡´é—®é¢˜B",
        "severity": {"level": "critical|high|medium|low"},
        "feasibility": {"constraints": [...], "opportunities": [...]}
      }
    `;

    const rootCauseAnalysis = await llmIntegration.chat(rootCausePrompt);

    // æ­¥éª¤3: è§„åˆ™éªŒè¯ï¼ˆé˜²æ­¢LLMå¹»è§‰ï¼‰
    const validated = this.validateWithRules(JSON.parse(rootCauseAnalysis), merchant);

    return validated;
  }

  private validateWithRules(llmDiagnosis: any, merchant: Merchant): any {
    // ç”¨è§„åˆ™å¼•æ“éªŒè¯LLMçš„è¯Šæ–­æ˜¯å¦åˆç†
    // ä¾‹å¦‚ï¼šLLMè¯´"ç§Ÿé‡‘è¿‡é«˜"ï¼Œæ£€æŸ¥å®é™…ç§Ÿå”®æ¯”æ˜¯å¦çœŸçš„>25%
    const validated = {...llmDiagnosis};

    validated.rootCauses = llmDiagnosis.rootCauses.filter(cause => {
      return this.hasDataSupport(cause, merchant);
    });

    return validated;
  }
}
```

#### ç¤ºä¾‹è¾“å‡º
```
é—®é¢˜: "æµ·åº•æè¥æ”¶ä¸‹æ»‘ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"

æ—§è¯Šæ–­: "è¥æ”¶ä½ã€å®¢æµå°‘" (æ ‡ç­¾)

æ–°è¯Šæ–­:
  ç—‡çŠ¶: è¿‘3ä¸ªæœˆè¥æ”¶æŒç»­ä¸‹æ»‘15%ï¼Œå·²ä½äºç›ˆäºå¹³è¡¡ç‚¹

  æ ¹å› 1: ä½ç½®åŠ£åŠ¿ï¼ˆä¸»å› ï¼Œç½®ä¿¡åº¦90%ï¼‰
    - è¯æ®: åº—é“ºä½äº3å±‚ï¼Œè¯¥å±‚å®¢æµé‡æ¯”1-2å±‚ä½40%
    - è¯æ®: åŒæ¥¼å±‚å…¶ä»–é¤é¥®ä¹Ÿè¡¨ç°ä¸ä½³
    - å½±å“: ç¿»å°ç‡ä»…1.8æ¬¡/å¤©ï¼ˆè¡Œä¸šæ ‡å‡†3.0æ¬¡ï¼‰

  æ ¹å› 2: ç§Ÿé‡‘å‹åŠ›ï¼ˆæ¬¡å› ï¼Œç½®ä¿¡åº¦80%ï¼‰
    - ç§Ÿå”®æ¯”28%ï¼ˆè­¦æˆ’çº¿25%ï¼‰
    - å›ºå®šæˆæœ¬è¿‡é«˜ï¼Œå³ä½¿å®¢æµæ¢å¤ä¹Ÿéš¾ç›ˆåˆ©

  ä¸¥é‡ç¨‹åº¦: é«˜å±ï¼ˆå¦‚3ä¸ªæœˆå†…æ— æ”¹å–„ï¼Œå°†æŒç»­äºæŸï¼‰
  é—®é¢˜ç±»å‹: ç»“æ„æ€§é—®é¢˜ï¼ˆéæš‚æ—¶æ³¢åŠ¨ï¼‰

  å¯è¡Œæ€§åˆ¤æ–­:
    - çŸ­æœŸæªæ–½æœ‰é™ï¼šè¥é”€æ‹‰å®¢æµæ•ˆæœä¸æ˜æ˜¾ï¼ˆä½ç½®é™åˆ¶ï¼‰
    - ä¸­æœŸæ–¹æ¡ˆï¼šéœ€å•†åœºé…åˆé™ç§Ÿæˆ–æ”¹å–„3å±‚ç¯å¢ƒ
    - é•¿æœŸè€ƒè™‘ï¼šè¯„ä¼°æ˜¯å¦éœ€è°ƒæ•´ä¸šæ€æˆ–é‡é€‰ä½ç½®
```

---

## ğŸ“ Phase 4: æ¡ˆä¾‹åŒ¹é… - ä»æ ‡ç­¾åˆ°è¯­ä¹‰

### 4.1 Semantic Case Matcher

**ä¿®æ”¹**: `skills/enhanced-ai-matcher.ts`

#### æ”¹è¿›: æ ¹å› åŒ¹é… + è¯­ä¹‰ç›¸ä¼¼åº¦ + LLMæ¨è

```typescript
class SemanticCaseMatcher {
  async matchCases(
    diagnosis: DiagnosisReport,
    merchant: Merchant
  ): Promise<MatchedCase[]> {
    // æ­¥éª¤1: åŸºäºæ ¹å› ç­›é€‰å€™é€‰æ¡ˆä¾‹
    const candidateCases = this.filterByRootCause(
      diagnosis.rootCauses,
      knowledgeBase
    );

    // æ­¥éª¤2: LLMè¯„ä¼°ç›¸ä¼¼åº¦
    const matchingPrompt = `
      å½“å‰å•†æˆ·é—®é¢˜ï¼š
      ${JSON.stringify(diagnosis.rootCauses)}

      å€™é€‰æ¡ˆä¾‹ï¼š
      ${candidateCases.map(c => `æ¡ˆä¾‹${c.id}: ${c.diagnosis}`).join('\n')}

      è¯·è¯„ä¼°æ¯ä¸ªæ¡ˆä¾‹ä¸å½“å‰é—®é¢˜çš„ç›¸å…³æ€§ï¼š
      è€ƒè™‘å› ç´ ï¼š
      1. æ ¹æœ¬åŸå› æ˜¯å¦ç›¸åŒï¼Ÿ
      2. è¡Œä¸šå·®å¼‚æœ‰å¤šå¤§ï¼Ÿ
      3. è§£å†³æ–¹æ¡ˆæ˜¯å¦å¯è¿ç§»ï¼Ÿ
      4. å¤–éƒ¨æ¡ä»¶æ˜¯å¦ç›¸ä¼¼ï¼Ÿ

      è¾“å‡ºæ ¼å¼ï¼š
      [{
        "caseId": "...",
        "matchScore": 0-100,
        "matchReason": "ä¸ºä»€ä¹ˆåŒ¹é…",
        "adaptationNeeded": "éœ€è¦å¦‚ä½•è°ƒæ•´æ–¹æ¡ˆ"
      }]
    `;

    const llmMatches = await llmIntegration.chat(matchingPrompt);
    const finalMatches = this.combineScores(JSON.parse(llmMatches), candidateCases);

    return finalMatches.sort((a, b) => b.score - a.score).slice(0, 5);
  }

  private filterByRootCause(rootCauses: any[], knowledgeBase: any[]): any[] {
    // é¢„ç­›é€‰ï¼šåªä¿ç•™æ ¹å› ç±»å‹ç›¸åŒçš„æ¡ˆä¾‹
    const causeKeywords = this.extractCauseKeywords(rootCauses);

    return knowledgeBase.filter(case => {
      const caseCauseKeywords = this.extractCauseKeywords([{cause: case.diagnosis}]);
      const overlap = this.calculateOverlap(causeKeywords, caseCauseKeywords);
      return overlap > 0.3; // è‡³å°‘30%å…³é”®è¯é‡åˆ
    });
  }
}
```

#### ç¤ºä¾‹
```
æ—§åŒ¹é…:
  ç«é”…"ç¼ºå®¢æµ" åŒ¹é… æœé¥°"ç¼ºå®¢æµ"ï¼ˆæ ‡ç­¾ç›¸åŒï¼‰
  â†’ æ¨èåŒæ ·çš„æªæ–½ï¼ˆè¥é”€æ´»åŠ¨ï¼‰

æ–°åŒ¹é…:
  ç­›é€‰: åªä¿ç•™"ä½ç½®åŠ£åŠ¿"æ ¹å› çš„æ¡ˆä¾‹
  LLMè¯„ä¼°:
    - æ¡ˆä¾‹Aï¼ˆç«é”…3å±‚ï¼‰vs å½“å‰ï¼ˆç«é”…3å±‚ï¼‰â†’ åŒ¹é…åˆ†85/100
    - æ¡ˆä¾‹Bï¼ˆæœé¥°3å±‚ï¼‰vs å½“å‰ï¼ˆç«é”…3å±‚ï¼‰â†’ åŒ¹é…åˆ†45/100
  é€‚åº”å»ºè®®:
    "æ¡ˆä¾‹Aé€šè¿‡å¢åŠ å¯¼æµæ ‡è¯†æ”¹å–„ï¼Œä½†ç«é”…éœ€é¢å¤–è€ƒè™‘æ°”å‘³ç®¡æ§"
```

---

## ğŸ“ Phase 5: Response Generation - åŠ¨æ€ç”Ÿæˆ

### 5.1 Dynamic Response Generator

**ä¿®æ”¹**: `skills/ai-assistant/response-generator.ts`

#### æ”¹è¿›: åºŸé™¤ç¡¬ç¼–ç æ¨¡æ¿ï¼Œæ”¹ç”¨LLMåŠ¨æ€ç”Ÿæˆ

```typescript
class DynamicResponseGenerator {
  async generate(
    structuredQuery: StructuredQuery,
    executionResult: any,
    merchant?: Merchant
  ): Promise<string> {
    // æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©ç”Ÿæˆç­–ç•¥
    switch (structuredQuery.type) {
      case 'single_merchant':
        return this.generateSingleMerchantResponse(structuredQuery, executionResult, merchant!);
      case 'aggregation':
        return this.generateAggregationResponse(structuredQuery, executionResult);
      case 'comparison':
        return this.generateComparisonResponse(structuredQuery, executionResult);
      case 'trend_analysis':
        return this.generateTrendResponse(structuredQuery, executionResult);
    }
  }

  private async generateSingleMerchantResponse(
    query: StructuredQuery,
    result: any,
    merchant: Merchant
  ): Promise<string> {
    const prompt = `
      ç”¨æˆ·é—®é¢˜ï¼š${query.originalInput}
      ç”¨æˆ·æ„å›¾ï¼š${query.intents.join(', ')}
      å•†æˆ·æ•°æ®ï¼š${JSON.stringify(result)}

      è¦æ±‚ï¼š
      1. ç›´æ¥å›ç­”ç”¨æˆ·çš„é—®é¢˜
      2. å¦‚æœç”¨æˆ·é—®"æœ€è¿‘æ€ä¹ˆæ ·"ï¼Œé‡ç‚¹è¯´è¶‹åŠ¿å˜åŒ–
      3. å¦‚æœå‘ç°ä¸¥é‡é—®é¢˜ï¼Œä¼˜å…ˆæç¤ºé£é™©
      4. ä½¿ç”¨Markdownæ ¼å¼ï¼Œç®€æ´æ¸…æ™°
      5. é¿å…å¥—è¯ï¼Œç›´å¥”ä¸»é¢˜

      æ ¼å¼å‚è€ƒï¼š
      # ${merchant.name} - [ä¸»é¢˜]
      [æ ¸å¿ƒç»“è®º 1-2å¥è¯]
      ## [ç»†èŠ‚]
      ğŸ’¡ **å»ºè®®**ï¼š[å¦‚æœæœ‰å»ºè®®]
    `;

    return await llmIntegration.chat(prompt);
  }

  private async generateAggregationResponse(
    query: StructuredQuery,
    result: AggregationResult
  ): Promise<string> {
    const prompt = `
      ç”¨æˆ·é—®é¢˜ï¼š${query.originalInput}
      ç»Ÿè®¡ç»“æœï¼š${JSON.stringify(result)}

      è¦æ±‚ï¼š
      1. çªå‡ºå…³é”®æ•°å­—
      2. å¼ºè°ƒå˜åŒ–è¶‹åŠ¿
      3. ç”¨è¡¨æ ¼æˆ–åˆ—è¡¨å±•ç¤ºåˆ†ç±»æ•°æ®
      4. æä¾›å¯æ“ä½œçš„æ´å¯Ÿ

      æ ¼å¼ï¼š
      # [æ—¶é—´èŒƒå›´]å•†æˆ·é£é™©ç»Ÿè®¡
      ## ğŸ“Š æ•´ä½“æƒ…å†µ
      ## ğŸ” é£é™©åˆ†å¸ƒ
      ## ğŸ’¡ å…³é”®æ´å¯Ÿ
    `;

    return await llmIntegration.chat(prompt);
  }
}
```

---

## ğŸ“ Phase 6: Agent Router - æ”¯æŒå¤æ‚æŸ¥è¯¢

### 6.1 Enhanced Agent Router

**ä¿®æ”¹**: `skills/ai-assistant/agent-router.ts`
**æ–°å¢**: `aggregation-executor.ts`, `comparison-executor.ts`

#### æ”¹è¿›: æ”¯æŒèšåˆæŸ¥è¯¢ã€å¯¹æ¯”åˆ†æã€å¤åˆæ„å›¾

```typescript
class AgentRouter {
  async process(userInput: string, conversationId: string): Promise<AgentExecutionResult> {
    // Phase 1: Query Analysis
    const structuredQuery = await queryAnalyzer.analyze(userInput, context);

    // Phase 2: Intent Classification
    const intents = await intentClassifier.classifyWithLLM(structuredQuery, context);

    // Phase 3: Entity Resolution
    let entities: ResolvedEntity;

    if (structuredQuery.type === 'single_merchant') {
      entities = await this.resolveSingleMerchant(structuredQuery, context);
      if (!entities.merchantId) {
        return this.createMerchantNotFoundResult(userInput);
      }
    } else {
      // èšåˆæŸ¥è¯¢ï¼šè§£æç­›é€‰æ¡ä»¶
      entities = {
        type: 'aggregation',
        filters: structuredQuery.filters,
        timeRange: structuredQuery.entities.timeRange,
      };
    }

    // Phase 4: Execution
    let result: any;

    if (structuredQuery.type === 'single_merchant') {
      result = await this.executeSingleMerchantPlan(executionPlan);
    } else if (structuredQuery.type === 'aggregation') {
      result = await this.executeAggregationPlan(executionPlan);
    } else if (structuredQuery.type === 'comparison') {
      result = await this.executeComparisonPlan(executionPlan);
    }

    // Phase 5: Response Generation
    const response = await responseGenerator.generate(structuredQuery, result);

    return { success: true, content: response };
  }

  private async executeAggregationPlan(plan: ExecutionPlan): Promise<AggregationResult> {
    const allMerchants = merchantDataManager.getAllMerchants();
    let filtered = allMerchants;

    // åº”ç”¨ç­›é€‰æ¡ä»¶
    if (plan.filters.riskLevel) {
      filtered = filtered.filter(m => plan.filters.riskLevel.includes(m.riskLevel));
    }

    // æ‰§è¡Œèšåˆæ“ä½œ
    if (plan.aggregations.operation === 'count') {
      return {
        operation: 'count',
        total: filtered.length,
        breakdown: this.groupBy(filtered, plan.aggregations.groupBy),
      };
    }
  }

  private async executeComparisonPlan(plan: ExecutionPlan): Promise<ComparisonResult> {
    const current = await this.getDataForPeriod(plan.entities.timeRange);
    const baseline = await this.getDataForPeriod(plan.entities.comparisonTarget);

    return {
      current,
      baseline,
      delta: this.calculateDelta(current, baseline),
      insights: await this.generateComparisonInsights(current, baseline),
    };
  }
}
```

---

## ğŸ“ Phase 7: Conversation Context å¢å¼º

### 7.1 Rich Context Management

**ä¿®æ”¹**: `utils/ai-assistant/conversationManager.ts`

#### æ”¹è¿›: è®°å½•æŸ¥è¯¢ç»“æ„ã€æ„å›¾è½¨è¿¹ã€é¢†åŸŸçŸ¥è¯†

```typescript
interface EnhancedConversationContext {
  conversationId: string;

  // æŸ¥è¯¢å†å²
  queryHistory: Array<{
    originalInput: string;
    structuredQuery: StructuredQuery;
    intents: Intent[];
    timestamp: string;
  }>;

  // è®¨è®ºè¿‡çš„å•†æˆ·æ ˆ
  merchantStack: Array<{
    id: string;
    name: string;
    discussedTopics: string[];  // ['health', 'risks', 'solutions']
    timestamp: string;
  }>;

  // ç”¨æˆ·åå¥½å­¦ä¹ 
  userPreferences: {
    preferredResponseStyle: 'detailed' | 'concise';
    frequentQueries: string[];
    focusAreas: string[];  // ['risk_management', 'performance_tracking']
  };

  // é¢†åŸŸä¸Šä¸‹æ–‡
  domainContext: {
    currentWorkflow?: 'diagnosis' | 'solution' | 'inspection' | 'evaluation';
    activeTask?: string;
    knownIssues: string[];
  };
}
```

---

## ğŸ“‹ æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ ¸å¿ƒæ¨¡å—ï¼ˆP0 - å¿…é¡»å®ç°ï¼‰

| æ–‡ä»¶ | æ“ä½œ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| `types/ai-assistant.ts` | ä¿®æ”¹ | æ‰©å±•Intentç±»å‹ï¼ˆ+6ä¸ªæ–°ç±»å‹ï¼‰ | P0 |
| `skills/ai-assistant/query-analyzer.ts` | **æ–°å»º** | LLMé©±åŠ¨çš„æŸ¥è¯¢ç»“æ„åŒ–è§£æ | P0 |
| `skills/ai-assistant/intent-classifier.ts` | é‡æ„ | LLMè¯­ä¹‰åˆ†ç±»æ›¿ä»£å…³é”®è¯åŒ¹é… | P0 |
| `skills/ai-diagnosis-engine.ts` | é‡æ„ | LLMå› æœæ¨ç† + è§„åˆ™éªŒè¯ | P0 |
| `skills/enhanced-ai-matcher.ts` | é‡æ„ | æ ¹å› åŒ¹é… + è¯­ä¹‰ç›¸ä¼¼åº¦ | P0 |
| `skills/ai-assistant/response-generator.ts` | é‡æ„ | åºŸé™¤æ¨¡æ¿ï¼Œæ”¹ç”¨LLMåŠ¨æ€ç”Ÿæˆ | P0 |
| `skills/ai-assistant/agent-router.ts` | æ‰©å±• | æ”¯æŒèšåˆ/å¯¹æ¯”/å¤åˆæŸ¥è¯¢ | P0 |

### æ–°å¢æ‰§è¡Œå™¨ï¼ˆP0ï¼‰

| æ–‡ä»¶ | æ“ä½œ | åŠŸèƒ½ |
|------|------|------|
| `skills/ai-assistant/aggregation-executor.ts` | æ–°å»º | èšåˆæŸ¥è¯¢æ‰§è¡Œï¼ˆç»Ÿè®¡ã€åˆ†ç»„ï¼‰ |
| `skills/ai-assistant/comparison-executor.ts` | æ–°å»º | å¯¹æ¯”åˆ†ææ‰§è¡Œï¼ˆvsä¸Šæœˆã€vsåŒè¡Œï¼‰ |
| `skills/business-context-provider.ts` | æ–°å»º | æä¾›å¤–éƒ¨ç¯å¢ƒæ•°æ®ï¼ˆå•†åœºå®¢æµã€ç«äº‰è€…ï¼‰ |

### å¢å¼ºæ¨¡å—ï¼ˆP1ï¼‰

| æ–‡ä»¶ | æ“ä½œ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| `utils/ai-assistant/conversationManager.ts` | å¢å¼º | è®°å½•æŸ¥è¯¢ç»“æ„ã€æ„å›¾è½¨è¿¹ | P1 |
| `utils/ai-assistant/llmClient.ts` | ä¼˜åŒ– | è§£å†³APIå®‰å…¨é—®é¢˜ã€ä¼˜åŒ–ç¼“å­˜ | P1 |

---

## ğŸ¯ å®æ–½ç­–ç•¥

### Iteration 1: æ ¸å¿ƒèƒ½åŠ›ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: è§£å†³"ç­”éæ‰€é—®"é—®é¢˜

**ä»»åŠ¡æ¸…å•**:
1. **Query Analyzer** - 2å¤©
   - [ ] å®ç°LLMç»“æ„åŒ–è§£æ
   - [ ] æµ‹è¯•å•å•†æˆ·/èšåˆ/å¯¹æ¯”æŸ¥è¯¢

2. **Intentæ‰©å±• + Agent Routerå‡çº§** - 2å¤©
   - [ ] æ–°å¢6ç§Intentç±»å‹
   - [ ] å®ç°èšåˆæŸ¥è¯¢æ‰§è¡Œé€»è¾‘
   - [ ] å®ç°å¯¹æ¯”åˆ†ææ‰§è¡Œé€»è¾‘

3. **Response Generatoré‡æ„** - 1å¤©
   - [ ] åºŸé™¤ç¡¬ç¼–ç æ¨¡æ¿
   - [ ] å®ç°LLMåŠ¨æ€ç”Ÿæˆ

4. **é›†æˆæµ‹è¯•** - 2å¤©
   - [ ] æµ‹è¯•å¤æ‚æŸ¥è¯¢åœºæ™¯

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ”¯æŒèšåˆç»Ÿè®¡æŸ¥è¯¢ï¼ˆ"å¤šå°‘é«˜é£é™©"ï¼‰
- âœ… æ”¯æŒå¯¹æ¯”åˆ†ææŸ¥è¯¢ï¼ˆ"vsä¸Šæœˆ"ï¼‰
- âœ… æ”¯æŒå¤åˆæ„å›¾è¯†åˆ«
- âœ… ResponseåŠ¨æ€ç”Ÿæˆ

### Iteration 2: æ™ºèƒ½è¯Šæ–­ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: è§£å†³"åƒç¯‡ä¸€å¾‹"é—®é¢˜

**ä»»åŠ¡æ¸…å•**:
1. **è¯Šæ–­å¼•æ“é‡æ„** - 3å¤©
   - [ ] LLMå› æœæ¨ç†
   - [ ] è§„åˆ™éªŒè¯é˜²å¹»è§‰
   - [ ] æµ‹è¯•å¤šç§ä¸šæ€

2. **æ¡ˆä¾‹åŒ¹é…å‡çº§** - 2å¤©
   - [ ] æ ¹å› ç­›é€‰
   - [ ] LLMç›¸ä¼¼åº¦è¯„ä¼°
   - [ ] æ–¹æ¡ˆä¸ªæ€§åŒ–è°ƒæ•´

3. **é›†æˆæµ‹è¯•** - 2å¤©

**éªŒæ”¶æ ‡å‡†**:
- âœ… è¯Šæ–­æŠ¥å‘ŠåŒ…å«æ ¹å› åˆ†æ
- âœ… æ¡ˆä¾‹åŸºäºæ ¹å› åŒ¹é…
- âœ… æ–¹æ¡ˆä¸ªæ€§åŒ–è°ƒæ•´

### Iteration 3: ä¸Šä¸‹æ–‡è®°å¿†ï¼ˆ3å¤©ï¼‰

**ç›®æ ‡**: æå‡å¤šè½®å¯¹è¯èƒ½åŠ›

**ä»»åŠ¡æ¸…å•**:
1. **Context Managerå¢å¼º** - 2å¤©
   - [ ] æŸ¥è¯¢å†å²è®°å½•
   - [ ] å•†æˆ·æ ˆç®¡ç†
   - [ ] ç”¨æˆ·åå¥½å­¦ä¹ 

2. **æµ‹è¯•éªŒè¯** - 1å¤©

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç†è§£ä¸Šä¸‹æ–‡å¼•ç”¨ï¼ˆ"å°é¾™åå‘¢"ï¼‰
- âœ… è®°å½•æŸ¥è¯¢å†å²
- âœ… å­¦ä¹ ç”¨æˆ·åå¥½

---

## ğŸ¯ éªŒè¯æ–¹æ¡ˆ

### æµ‹è¯•åœºæ™¯1: èšåˆç»Ÿè®¡

```
ç”¨æˆ·ï¼š"è¿™ä¸ªæœˆå¤šå°‘é«˜é£é™©å•†æˆ·ï¼Œå’Œä¸Šä¸ªæœˆæ¯”æ€ä¹ˆæ ·ï¼Ÿ"

é¢„æœŸæµç¨‹ï¼š
1. QueryAnalyzerè§£æï¼š
   - type: "aggregation"
   - filters: {riskLevel: ["high", "critical"]}
   - timeRange: "current_month"
   - comparisonTarget: "last_month"

2. IntentClassifierè¯†åˆ«ï¼š
   - intents: ["risk_statistics", "trend_comparison"]

3. AggregationExecutoræ‰§è¡Œï¼š
   - ç­›é€‰é«˜é£é™©å•†æˆ·
   - è®¡ç®—å½“å‰æœˆå’Œä¸Šæœˆæ•°é‡
   - è®¡ç®—å˜åŒ–ç™¾åˆ†æ¯”

4. ResponseGeneratorç”Ÿæˆï¼š
   # 2024å¹´2æœˆå•†æˆ·é£é™©ç»Ÿè®¡
   ## ğŸ“Š æ•´ä½“æƒ…å†µ
   - æ€»å•†æˆ·æ•°ï¼š156ä¸ª
   - é«˜é£é™©ï¼š12ä¸ªï¼ˆ7.7%ï¼‰â†‘ vs ä¸Šæœˆ9ä¸ªï¼ˆ5.8%ï¼‰
   - æ–°å¢é«˜é£é™©ï¼š5ä¸ªï¼ˆæµ·åº•æã€å°é¾™å...ï¼‰

é¢„æœŸç»“æœï¼šâœ… å‡†ç¡®å›ç­”ç»Ÿè®¡é—®é¢˜ï¼ŒåŒ…å«å¯¹æ¯”
```

### æµ‹è¯•åœºæ™¯2: æ ¹å› è¯Šæ–­

```
ç”¨æˆ·ï¼š"æµ·åº•æè¥æ”¶ä¸‹æ»‘ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"

é¢„æœŸæµç¨‹ï¼š
1. QueryAnalyzerè§£æï¼š
   - type: "single_merchant"
   - merchants: ["æµ·åº•æ"]
   - intents: ["risk_diagnosis", "root_cause_analysis"]

2. AIDiagnosisEngineè¯Šæ–­ï¼š
   - æ”¶é›†å•†æˆ·æ•°æ®ã€å•†åœºç¯å¢ƒã€ç«äº‰å¯¹æ‰‹
   - LLMè¿›è¡Œå› æœæ¨ç†
   - è§„åˆ™éªŒè¯è¯Šæ–­ç»“æœ

3. ResponseGeneratorç”Ÿæˆï¼š
   # æµ·åº•æ - è¥æ”¶ä¸‹æ»‘æ ¹å› åˆ†æ
   **æ ¸å¿ƒé—®é¢˜**ï¼šè¿‘3ä¸ªæœˆè¥æ”¶æŒç»­ä¸‹æ»‘15%

   ## ğŸ” æ ¹æœ¬åŸå› 
   1. **ä½ç½®åŠ£åŠ¿**ï¼ˆä¸»å› ï¼Œç½®ä¿¡åº¦90%ï¼‰
      - è¯æ®ï¼šåº—é“ºä½äº3å±‚ï¼Œè¯¥å±‚å®¢æµé‡æ¯”1-2å±‚ä½40%
      - å½±å“ï¼šç¿»å°ç‡ä»…1.8æ¬¡/å¤©ï¼ˆè¡Œä¸šæ ‡å‡†3.0æ¬¡ï¼‰

   2. **ç§Ÿé‡‘å‹åŠ›**ï¼ˆæ¬¡å› ï¼Œç½®ä¿¡åº¦80%ï¼‰
      - ç§Ÿå”®æ¯”28%ï¼ˆè­¦æˆ’çº¿25%ï¼‰

é¢„æœŸç»“æœï¼šâœ… æ·±åº¦åˆ†æåŸå› ï¼Œè€Œéå¥—ç”¨æ¨¡æ¿
```

### æµ‹è¯•åœºæ™¯3: è¿ç»­å¯¹è¯

```
ç¬¬1è½®ï¼š"æµ·åº•ææœ€è¿‘æ€ä¹ˆæ ·"
å“åº”ï¼šå¥åº·åº¦æŠ¥å‘Š + é£é™©æç¤º

ç¬¬2è½®ï¼š"å°é¾™åå‘¢"
é¢„æœŸï¼šè¯†åˆ«ä¸ºfollow-up queryï¼Œè¿”å›å°é¾™åçš„æƒ…å†µ

ç¬¬3è½®ï¼š"å¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤å®¶"
é¢„æœŸï¼š
- è¯†åˆ«merchants: ["æµ·åº•æ", "å°é¾™å"]ï¼ˆä»å†å²æå–ï¼‰
- type: "comparison"
- ç”Ÿæˆå¯¹æ¯”è¡¨æ ¼

é¢„æœŸç»“æœï¼šâœ… ç†è§£ä¸Šä¸‹æ–‡å¼•ç”¨
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½å±‚é¢
1. âœ… æ”¯æŒèšåˆç»Ÿè®¡æŸ¥è¯¢ï¼ˆ"å¤šå°‘é«˜é£é™©"ï¼‰
2. âœ… æ”¯æŒå¯¹æ¯”åˆ†ææŸ¥è¯¢ï¼ˆ"vsä¸Šæœˆ"ï¼‰
3. âœ… æ”¯æŒå¤åˆæ„å›¾è¯†åˆ«ï¼ˆä¸€å¥è¯å¤šä¸ªå­æŸ¥è¯¢ï¼‰
4. âœ… è¯Šæ–­æŠ¥å‘ŠåŒ…å«æ ¹å› åˆ†æï¼ˆè€Œéå¥—ç”¨æ ‡ç­¾ï¼‰
5. âœ… æ¡ˆä¾‹åŒ¹é…åŸºäºæ ¹å› ç›¸ä¼¼åº¦ï¼ˆè€Œéæ ‡ç­¾åŒ¹é…ï¼‰
6. âœ… ResponseåŠ¨æ€ç”Ÿæˆï¼ˆè€Œéå›ºå®šæ¨¡æ¿ï¼‰

### ç”¨æˆ·ä½“éªŒå±‚é¢
1. âœ… ä¸å†ç­”éæ‰€é—®ï¼ˆå‡†ç¡®ç†è§£å¤æ‚æŸ¥è¯¢ï¼‰
2. âœ… ä¸å†åƒç¯‡ä¸€å¾‹ï¼ˆä¸ªæ€§åŒ–è¯Šæ–­å’Œå»ºè®®ï¼‰
3. âœ… æ”¯æŒè‡ªç„¶å¯¹è¯ï¼ˆ"å°é¾™åå‘¢"èƒ½ç†è§£ï¼‰
4. âœ… æä¾›å¯æ“ä½œæ´å¯Ÿï¼ˆä¸åªæ˜¯æ•°å­—å †ç Œï¼‰

### æŠ€æœ¯æŒ‡æ ‡
1. âœ… Queryè§£æå‡†ç¡®ç‡ > 90%
2. âœ… Intentè¯†åˆ«å‡†ç¡®ç‡ > 85%ï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
3. âœ… æ ¹å› è¯Šæ–­æœ‰æ•ˆæ€§ > 80%ï¼ˆéœ€äººå·¥è¯„ä¼°ï¼‰
4. âœ… å“åº”æ—¶é—´ < 5ç§’ï¼ˆåŒ…å«LLMè°ƒç”¨ï¼‰

---

## âš ï¸ é£é™©ä¸ç¼“è§£

### é£é™©1: LLMæˆæœ¬

**é£é™©**: å¤§é‡è°ƒç”¨LLMä¼šå¢åŠ æˆæœ¬

**ç¼“è§£**:
- å¯¹ç®€å•æŸ¥è¯¢ä»ç”¨è§„åˆ™å¼•æ“ï¼ˆ"æµ·åº•æå¥åº·åº¦"æ— éœ€LLMï¼‰
- LLMä»…ç”¨äºå¤æ‚åˆ†æï¼ˆèšåˆã€è¯Šæ–­ã€åŒ¹é…ï¼‰
- å®æ–½æ™ºèƒ½ç¼“å­˜ï¼ˆè¯­ä¹‰ç›¸ä¼¼æŸ¥è¯¢å‘½ä¸­ç¼“å­˜ï¼‰
- ä½¿ç”¨è½»é‡æ¨¡å‹ï¼ˆGPT-3.5/Qwenï¼‰å¤„ç†ç»“æ„åŒ–ä»»åŠ¡

### é£é™©2: LLMå¹»è§‰

**é£é™©**: LLMå¯èƒ½ç”Ÿæˆä¸å‡†ç¡®çš„è¯Šæ–­

**ç¼“è§£**:
- è§„åˆ™éªŒè¯å±‚ï¼ˆæ£€æŸ¥LLMè¯Šæ–­æ˜¯å¦æœ‰æ•°æ®æ”¯æ’‘ï¼‰
- ç½®ä¿¡åº¦è¯„ä¼°ï¼ˆä½ç½®ä¿¡åº¦æ—¶æ ‡æ³¨"æ¨æµ‹"ï¼‰
- äººå·¥åé¦ˆå¾ªç¯ï¼ˆç”¨æˆ·çº æ­£åæ›´æ–°çŸ¥è¯†åº“ï¼‰

### é£é™©3: å®æ–½å¤æ‚åº¦

**é£é™©**: å¤§é‡é‡æ„å¯èƒ½å¼•å…¥æ–°bug

**ç¼“è§£**:
- åˆ†3ä¸ªè¿­ä»£æ¸è¿›å¼å®æ–½
- ä¿ç•™æ—§ä»£ç ä½œä¸ºfallback
- æ¯ä¸ªè¿­ä»£å……åˆ†æµ‹è¯•åå†è¿›å…¥ä¸‹ä¸€ä¸ª

---

## ğŸ“Š å½“å‰è¿›åº¦

### Phase å®ŒæˆçŠ¶æ€

| Phase | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|-------|------|------|----------|
| Phase 1 | Query Understanding | â³ å¾…å¼€å§‹ | - |
| Phase 2 | Intent System | â³ å¾…å¼€å§‹ | - |
| Phase 3 | è¯Šæ–­å¼•æ“ | â³ å¾…å¼€å§‹ | - |
| Phase 4 | æ¡ˆä¾‹åŒ¹é… | â³ å¾…å¼€å§‹ | - |
| Phase 5 | Responseç”Ÿæˆ | â³ å¾…å¼€å§‹ | - |
| Phase 6 | Agent Router | â³ å¾…å¼€å§‹ | - |
| Phase 7 | Contextå¢å¼º | â³ å¾…å¼€å§‹ | - |

### Iteration å®ŒæˆçŠ¶æ€

| Iteration | ç›®æ ‡ | çŠ¶æ€ | è¿›åº¦ |
|-----------|------|------|------|
| Iteration 1 | æ ¸å¿ƒèƒ½åŠ› | â³ å¾…å¼€å§‹ | 0/4 ä»»åŠ¡ |
| Iteration 2 | æ™ºèƒ½è¯Šæ–­ | â³ å¾…å¼€å§‹ | 0/3 ä»»åŠ¡ |
| Iteration 3 | ä¸Šä¸‹æ–‡è®°å¿† | â³ å¾…å¼€å§‹ | 0/2 ä»»åŠ¡ |

---

## ğŸ“ åç»­å·¥ä½œ

### çŸ­æœŸï¼ˆIteration 1ï¼‰
- [ ] åˆ›å»º `skills/ai-assistant/query-analyzer.ts`
- [ ] ä¿®æ”¹ `types/ai-assistant.ts` æ‰©å±•Intent
- [ ] é‡æ„ `skills/ai-assistant/intent-classifier.ts`
- [ ] åˆ›å»º `skills/ai-assistant/aggregation-executor.ts`
- [ ] åˆ›å»º `skills/ai-assistant/comparison-executor.ts`
- [ ] é‡æ„ `skills/ai-assistant/response-generator.ts`

### ä¸­æœŸï¼ˆIteration 2ï¼‰
- [ ] é‡æ„ `skills/ai-diagnosis-engine.ts`
- [ ] é‡æ„ `skills/enhanced-ai-matcher.ts`
- [ ] åˆ›å»º `skills/business-context-provider.ts`

### é•¿æœŸï¼ˆIteration 3ï¼‰
- [ ] å¢å¼º `utils/ai-assistant/conversationManager.ts`
- [ ] ä¼˜åŒ– `utils/ai-assistant/llmClient.ts`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å®Œæ•´è§„åˆ’**: `/Users/heyuxuan/.claude/plans/majestic-booping-cat.md`
- **é¡¹ç›®ä¸Šä¸‹æ–‡**: `CONTEXT.md`
- **ç‰ˆæœ¬å†å²**: `VERSION.md`
- **å˜æ›´æ—¥å¿—**: `docs/CHANGELOG.md`

---

## ğŸ”š æ€»ç»“

v3.0ç‰ˆæœ¬æ˜¯AIé—®ç­”åŠ©æ‰‹çš„**ç³»ç»Ÿæ€§æ¶æ„é‡æ„**ï¼Œä»"è§„åˆ™åŒ¹é…çš„Chatbot"å‡çº§ä¸º"æ¨ç†é©±åŠ¨çš„AI Agent"ã€‚

**æ ¸å¿ƒä»·å€¼**:
- âœ… è§£å†³"ç­”éæ‰€é—®"é—®é¢˜ï¼ˆæ”¯æŒèšåˆã€å¯¹æ¯”ã€å¤åˆæŸ¥è¯¢ï¼‰
- âœ… è§£å†³"åƒç¯‡ä¸€å¾‹"é—®é¢˜ï¼ˆæ ¹å› è¯Šæ–­ + ä¸ªæ€§åŒ–å“åº”ï¼‰
- âœ… æå‡ç”¨æˆ·ä½“éªŒï¼ˆè‡ªç„¶å¯¹è¯ + å¯æ“ä½œæ´å¯Ÿï¼‰

**é‡è¦åŸåˆ™**:
- âš ï¸ ä»…é‡æ„AIé—®ç­”åŠ©æ‰‹æ¨¡å—
- âœ… å…¶ä»–åŠŸèƒ½ä¿æŒç°æœ‰é€»è¾‘ä¸å˜
- ğŸ”„ åˆ†3ä¸ªè¿­ä»£æ¸è¿›å¼å®æ–½
- ğŸ§ª å……åˆ†æµ‹è¯•ï¼Œä¿è¯è´¨é‡

---

**åˆ›å»ºæ—¶é—´**: 2026-02-07
**æœ€åæ›´æ–°**: 2026-02-07
**ç»´æŠ¤äºº**: Claude Sonnet 4.5
**çŠ¶æ€**: è§„åˆ’å®Œæˆï¼Œå¾…å®æ–½
