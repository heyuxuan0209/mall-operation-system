# 🔍 数据一致性检查报告

**检查时间**: 2026-02-01 19:15
**问题**: 浏览器显示数据与脚本/数据源不一致

---

## 📊 数据对比分析

### 实际数据源（data/merchants/mock-data.ts）
```
✅ 商户总数: 18户
✅ 高风险商户(<60分): 2户
   - M001 海底捞: 45分
   - M005 绿茶: 58分
✅ 平均健康度: 78分
✅ 知识库案例: 26个
```

### 用户浏览器显示
```
✅ 商户总数: 18户（一致）
❌ 高风险商户: 1户（数据源有2户）
❌ 平均健康分: 80分（数据源78分）
✅ 知识库案例: 26个（一致）
```

### 脚本/旁白内容
```
✅ 商户总数: 18户
✅ 高风险商户: 2户
✅ 平均健康度: 78分
❌ 知识库案例: 47个（实际26个）
```

---

## 🎯 问题分析

### 问题1: 浏览器高风险商户数量不对
**原因**: 可能是localStorage中的数据被修改过，或者某个商户的评分/风险等级被更新了

**解决方案**: 清除浏览器localStorage，让系统重新加载数据源

### 问题2: 浏览器平均健康分不对（80 vs 78）
**原因**: 同上，localStorage数据不同步

**解决方案**: 清除localStorage

### 问题3: 脚本说知识库47个，实际26个
**原因**: 脚本编写时使用了错误的数据

**解决方案**: 修改脚本和配音，改为26个

### 问题4: 待处理商户列表没有海底捞
**原因**: 前端页面可能根据localStorage数据筛选，需要清除缓存

---

## 🔧 修复方案

### 方案A：修改脚本以匹配浏览器（推荐）⭐⭐⭐⭐⭐

**思路**: 不动浏览器数据，修改脚本适应当前显示

**优点**:
- 快速，不需要刷新浏览器
- 立即可以开始录制

**缺点**:
- 脚本与数据源文件不一致
- 如果清除localStorage，又会不一致

**修改内容**:
1. 高风险商户: 2户 → 1户
2. 平均健康度: 78分 → 80分
3. 知识库案例: 47个 → 26个

---

### 方案B：清除localStorage，重新加载数据（标准）⭐⭐⭐⭐⭐

**思路**: 让浏览器重新从数据源加载，保证数据一致

**优点**:
- 数据完全一致
- 符合数据源设计
- 长期正确

**缺点**:
- 需要刷新浏览器
- 需要修改知识库数量（47→26）

**操作步骤**:
1. 打开浏览器开发者工具（F12）
2. 控制台运行: `localStorage.clear()`
3. 刷新页面（Cmd+R）
4. 数据重新加载

**修改内容**:
1. 只需修改: 知识库案例 47个 → 26个

---

## 💡 我的建议

**推荐方案B**（清除localStorage）:
1. 保证数据源与显示一致
2. 只需修改1处（知识库数量）
3. 以后重新加载也不会出错

---

## 🚀 立即执行修复

### 第1步：清除浏览器缓存（30秒）

在浏览器（localhost:3000）中：
1. 按 `F12` 或 `Cmd+Option+I` 打开开发者工具
2. 点击"Console"（控制台）标签
3. 输入并回车：
   ```javascript
   localStorage.clear()
   location.reload()
   ```
4. 页面会自动刷新，数据重新加载

### 第2步：验证数据（30秒）

刷新后检查首页显示：
- [ ] 商户总数: 18户
- [ ] 高风险商户: 2户 ← 应该变成2户了
- [ ] 平均健康度: 78分 ← 应该变成78分了
- [ ] 知识库案例: 26个

### 第3步：修改脚本和配音（2分钟）

只需修改1处：知识库案例数量 47 → 26

---

## 📋 需要修改的文件

### 文档文件
1. `docs/RECORDING-SCRIPT-PART1.md`
2. `docs/VOICEOVER-TEXT-PART1.txt`
3. `docs/USER-JOURNEY-FOR-DEMO.md`
4. `docs/RECORDING-PREP-CHECK.md`

### 配音文件
需要重新生成配音（如果旁白中提到知识库数量）

---

## ⚠️ 健康度分布问题

用户提到："健康度分布展示的和对白脚本也不同"

### 实际数据源分布
```
高风险(<60):  2户 (11%)  - 海底捞45分, 绿茶58分
中风险(60-69): 3户 (17%)  - 蜀大侠65分, 博纳67分, 外婆家68分
低风险(70-89): 10户 (55%)
无风险(>=90): 3户 (17%)  - 周大福92分, 周生生93分, 喜茶90分
```

### 脚本中的描述
```
"饼图显示，11%的商户处于高风险，17%处于中风险..."
```

### 结论
✅ **脚本描述与数据源一致！** 清除localStorage后应该就对了。

---

## 🔄 完整修复流程

### 第1步：清除浏览器数据
```javascript
// 在浏览器控制台运行
localStorage.clear()
location.reload()
```

### 第2步：验证数据一致性
- 高风险商户: 2户
- 平均健康度: 78分
- 知识库案例: 26个

### 第3步：修改脚本（知识库数量）
```bash
# 批量替换
cd "/Users/heyuxuan/Desktop/Mall Operation Agent/mall-operation-system"
sed -i '' 's/47个/26个/g' docs/*.md docs/*.txt
```

### 第4步：重新生成配音（如有必要）
```bash
bash scripts/generate-audio-natural.sh
```

---

## ✅ 执行检查清单

- [ ] 浏览器localStorage已清除
- [ ] 页面已刷新
- [ ] 首页数据验证通过（2户高风险、78分平均）
- [ ] 脚本中知识库数量已修改（47→26）
- [ ] 配音已重新生成（如有必要）
- [ ] 最终验证：脚本与浏览器完全一致

---

**下一步**: 执行方案B，立即修复！
