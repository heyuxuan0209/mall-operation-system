# 🧪 开始测试 - 实时指南

## 当前状态
- ✅ 开发服务器运行中 (http://localhost:3000)
- ✅ 测试助手页面已打开
- ✅ 所有工具就绪

---

## 🚀 测试步骤（跟着做）

### 第一步：清理环境（必须！）

**在测试助手页面中：**
1. 点击 **"清空测试数据"** 按钮
2. 确认清空

**或者在浏览器控制台运行：**
```javascript
localStorage.clear();
console.log('✓ 数据已清空');
```

---

### 第二步：打开巡检页面

**方式1（推荐）：** 在测试助手页面点击 **"打开巡检页面"** 按钮

**方式2：** 直接访问
```
http://localhost:3000/inspection
```

---

### 第三步：快速验证（5分钟核心功能测试）

#### 3.1 检查初始状态
✅ 检查点：
- [ ] 页面正常加载，无错误
- [ ] 看到"现场巡店"标题
- [ ] 看到"星巴克咖啡"商户名称

#### 3.2 测试签到功能
1. 找到 **"快捷签到"** 模块
2. 点击 **"一键签到"** 按钮

✅ 检查点：
- [ ] 按钮显示加载状态
- [ ] 出现绿色对勾 ✓
- [ ] 显示签到时间
- [ ] 显示商户画像卡片
- [ ] **健康度显示：65分**
- [ ] **风险等级：中风险**

**如果看到其他数值，说明 localStorage 未清空，请返回第一步！**

#### 3.3 测试照片分类（核心功能）
1. 滚动到 **"拍照记录"** 模块
2. 点击 **"选择图片"** 按钮
3. 选择任意一张图片（建议准备一张测试图片）

✅ 检查点：
- [ ] 上传后自动弹出 **"照片分类"** 弹窗
- [ ] 弹窗显示照片预览
- [ ] 看到三个分类按钮（👥人 / 📦货 / 🏪场）

4. 点击 **"🏪 场（环境）"**

✅ 检查点：
- [ ] 按钮高亮
- [ ] 下方出现标签选项（环境整洁、灯光明亮等）

5. 选择 **"环境整洁"** 和 **"灯光明亮"** 标签
6. 问题等级选择 **"良好"**
7. 备注填写：**"店面环境很好"**
8. 点击 **"确认"** 按钮

✅ 检查点：
- [ ] 弹窗关闭
- [ ] 照片出现在下方网格中
- [ ] 照片上有分类标签（🏪 场）
- [ ] 照片上有等级标签（良好）
- [ ] 照片计数显示 1/5

#### 3.4 测试快速评分
1. 滚动到 **"快速评分"** 模块
2. 点击预设 **"优秀"** 按钮

✅ 检查点：
- [ ] 所有滑块自动调整到 85 左右
- [ ] 预设按钮高亮

3. 手动调整各项评分：
   - 人（员工）：**85**
   - 货（商品）：**85**
   - 场（环境）：**90**
   - 整体印象：**87**

✅ 检查点：
- [ ] 滑块可以拖动
- [ ] 分数实时更新
- [ ] 显示等级标签

#### 3.5 保存巡检记录（关键测试）
1. 滚动到底部
2. 点击 **"保存巡店记录"** 按钮

✅ 检查点：
- [ ] 按钮可以点击（不是禁用状态）
- [ ] 弹出 **"保存成功"** 反馈弹窗

#### 3.6 验证反馈弹窗（最重要）

**必须检查的内容：**

📊 **健康度变化**
- [ ] 显示 **"之前：65"**
- [ ] 显示 **"现在：72"**（或接近的值）
- [ ] 显示上升箭头 **↑**
- [ ] 显示变化值 **"+7"**（或接近）

✨ **改进亮点**
- [ ] 包含 "环境整洁表现良好"
- [ ] 包含 "现场环境整洁明亮"
- [ ] 包含 "员工服务态度优秀"

⚠️ **需要关注**
- [ ] 列表为空或很少（因为是良好巡检）

3. 点击 **"知道了"** 按钮

✅ 检查点：
- [ ] 弹窗关闭
- [ ] 表单被重置（照片清空）

---

### 第四步：验证数据持久化

**打开浏览器控制台** (F12 或 Cmd+Option+I)

#### 4.1 检查巡检记录
```javascript
const records = JSON.parse(localStorage.getItem('inspection_records'));
console.log('巡检记录数量:', records.length);
console.log('最新记录:', records[0]);
console.log('照片数量:', records[0].photos.length);
console.log('评分:', records[0].rating);
console.log('问题:', records[0].issues);
```

✅ 预期结果：
```
巡检记录数量: 1
照片数量: 1
评分: {people: 85, merchandise: 85, place: 90, overall: 87}
问题: []  (空数组，因为没有问题照片)
```

#### 4.2 检查商户健康度是否更新
```javascript
const merchants = JSON.parse(localStorage.getItem('merchants'));
const merchant = merchants[0];
console.log('商户名称:', merchant.name);
console.log('更新后健康度:', merchant.totalScore);
console.log('风险等级:', merchant.riskLevel);
console.log('更新时间:', new Date(merchant.updatedAt).toLocaleString());
```

✅ 预期结果：
```
商户名称: "星巴克咖啡"
更新后健康度: 72 (不是 65！)
风险等级: "medium"
```

#### 4.3 运行一致性验证
```javascript
// 加载验证脚本
const script = document.createElement('script');
script.textContent = `
  const merchants = JSON.parse(localStorage.getItem('merchants'));
  const score = merchants[0].totalScore;
  const risk = merchants[0].riskLevel;

  const expectedRisk = score >= 80 ? 'low' : score >= 60 ? 'medium' :
                       score >= 40 ? 'high' : 'critical';

  console.log('==== 一致性检查 ====');
  console.log('健康度:', score);
  console.log('风险等级:', risk);
  console.log('预期等级:', expectedRisk);
  console.log('一致性:', risk === expectedRisk ? '✓ 正确' : '✗ 错误');
`;
document.head.appendChild(script);
```

✅ 预期结果：
```
==== 一致性检查 ====
健康度: 72
风险等级: medium
预期等级: medium
一致性: ✓ 正确
```

---

### 第五步：测试数据连续性（重要！）

**目的：验证第二次巡检基于第一次的结果计算，而不是重新从 65 开始**

1. **刷新页面** (F5)

2. **再次签到**

✅ 检查点：
- [ ] **健康度显示：72**（不是 65！）
- [ ] 风险等级：中风险

**如果还是 65，说明数据未正确更新，有 Bug！**

3. **进行第二次巡检**
   - 上传 1 张照片（场，严重，卫生问题）
   - 评分全部低分（40 左右）
   - 保存

4. **查看反馈弹窗**

✅ 检查点：
- [ ] 显示 **"之前：72"**（基于第一次的结果）
- [ ] 显示 **"现在：52"**（或类似下降的值）
- [ ] 显示下降箭头 **↓**
- [ ] 关注点列表较长

---

## ✅ 快速验证通过标准

如果以下所有项都通过，说明核心功能正常：

- [x] 页面可以正常加载
- [x] 签到功能工作正常
- [x] 照片分类弹窗出现并可操作
- [x] 可以选择分类和标签
- [x] 评分滑块可以拖动
- [x] 保存后弹出反馈弹窗
- [x] 反馈弹窗显示正确的健康度变化（65 → 72+）
- [x] 数据保存到 localStorage
- [x] 商户健康度被更新（65 → 72+）
- [x] **刷新后显示更新后的健康度（72，不是 65）**

---

## ❌ 如果遇到问题

### 问题 1: 健康度一直是 65
**原因：** localStorage 未清空或数据未更新

**解决：**
```javascript
localStorage.clear();
location.reload();
```

### 问题 2: 分类弹窗不出现
**原因：** JavaScript 错误

**检查：**
1. 打开控制台 (F12)
2. 查看 Console 标签是否有红色错误
3. 截图错误信息

### 问题 3: 保存后无反应
**原因：** 未完成签到

**解决：**
1. 确保先点击"一键签到"
2. 看到绿色对勾后再保存

### 问题 4: 反馈弹窗数据不对
**原因：** 计算逻辑问题

**验证：**
```javascript
// 手动计算预期分数
// 初始: 65
// 评分: 87平均 (85+85+90+87)/4 = 86.75 ≈ 87
// 评分影响: +5 (平均 87 >= 80)
// 照片影响: +1 (1张良好)
// 预期: 65 + 5 + 1 = 71
```

---

## 📊 测试记录

测试时间：_______________

| 测试项 | 状态 | 备注 |
|-------|------|------|
| 页面加载 | ⬜ 通过 ⬜ 失败 | |
| 签到功能 | ⬜ 通过 ⬜ 失败 | |
| 照片分类 | ⬜ 通过 ⬜ 失败 | |
| 快速评分 | ⬜ 通过 ⬜ 失败 | |
| 保存记录 | ⬜ 通过 ⬜ 失败 | |
| 反馈弹窗 | ⬜ 通过 ⬜ 失败 | |
| 数据持久化 | ⬜ 通过 ⬜ 失败 | |
| 健康度更新 | ⬜ 通过 ⬜ 失败 | |
| 数据连续性 | ⬜ 通过 ⬜ 失败 | |

**整体结果：** ⬜ 全部通过 ⬜ 部分通过 ⬜ 失败

---

## 🎯 下一步

### 如果快速验证全部通过 ✅
继续完整的 6 个场景测试：
- 参考：`docs/phase5-e2e-testing-guide.md`

### 如果发现问题 ❌
1. 记录问题详情（截图 + 控制台日志）
2. 评估严重程度
3. 报告问题

---

**准备好了吗？按照上面的步骤开始测试吧！** 🚀

有任何问题随时说！
