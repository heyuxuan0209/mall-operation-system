# 【待办】商户帮扶档案 Skills 提取计划

**创建日期**: 2026-02-01
**状态**: 📋 待执行（日后迭代）
**优先级**: P1（重要但非紧急）
**预计工作量**: 11-15小时

---

## 📋 背景

商户帮扶档案功能已完成Phase 1+2开发，包含完整的历史追踪、措施分析、档案摘要等功能。当前业务逻辑分散在多个文件中，建议日后迭代时提取为独立Skills模块。

### 当前实现位置
```
utils/historyArchiveService.ts          # 档案服务类（500行）
utils/measureEffectivenessAnalyzer.ts   # 措施分析器（260行）
data/history/mockHistoryData.ts         # 历史数据生成（450行）
```

---

## 🎯 计划提取的5个Skills

### P0 - 核心业务逻辑（立即提取）

#### 1. Archive Summary Generator（档案摘要生成器）
**文件位置**: `skills/archive-summary-generator.ts`
**核心功能**:
- 计算帮扶成功率（基于任务实际效果）
- 统计风险等级变更次数
- 分析健康度趋势（最高/最低/平均）
- 识别最长风险期
- 生成总体统计指标

**预计工作量**: 2-3小时
**可复用性**: ⭐⭐⭐⭐⭐

#### 2. Measure Effectiveness Analyzer（措施有效性分析器）
**文件位置**: `skills/measure-effectiveness-analyzer.ts`（已存在，需重构）
**核心功能**:
- 统计每个措施的使用次数
- 计算平均改善值
- 统计高效/中效/低效次数
- 按维度分析措施效果
- 生成Top N排行榜

**预计工作量**: 1-2小时
**可复用性**: ⭐⭐⭐⭐⭐

---

### P1 - 重要功能（短期提取）

#### 3. Snapshot Generator（历史快照生成器）
**文件位置**: `skills/snapshot-generator.ts`
**核心功能**:
- 根据任务时间点生成快照
- 计算历史评分变化
- 推断历史风险等级
- 关联任务和快照
- 生成触发事件记录

**预计工作量**: 3-4小时
**可复用性**: ⭐⭐⭐⭐

#### 4. Risk Change Tracker（风险变更追踪器）
**文件位置**: `skills/risk-change-tracker.ts`
**核心功能**:
- 检测风险等级变化
- 判断变化类型（改善/恶化）
- 计算风险持续时长
- 识别异常风险期
- 生成变更时间线

**预计工作量**: 2-3小时
**可复用性**: ⭐⭐⭐⭐⭐

---

### P2 - 增强功能（长期优化）

#### 5. Trend Data Generator（趋势数据生成器）
**文件位置**: `skills/trend-data-generator.ts`
**核心功能**:
- 生成时间序列数据点
- 平滑异常波动
- 填充缺失数据
- 按维度提取趋势
- 生成预测数据点（可选）

**预计工作量**: 2-3小时
**可复用性**: ⭐⭐⭐⭐

---

## 🎯 提取收益

### 短期收益
- ✅ 代码结构更清晰（业务逻辑与展示分离）
- ✅ 更易于测试（纯函数可独立测试）
- ✅ 便于Bug定位和修复

### 长期收益
- ✅ 可在其他项目复用（商户管理、客户管理等）
- ✅ 算法优化容易（集中管理，影响范围可控）
- ✅ 团队协作友好（清晰的API边界）

### 可复用场景
1. 其他商户管理系统
2. 客户帮扶系统
3. 项目健康度追踪
4. 任何需要历史追踪的系统

---

## 📊 工作量估算

| 阶段 | Skills数量 | 预估时间 | 优先级 |
|------|-----------|---------|--------|
| P0 | 2个 | 4-5小时 | 立即 |
| P1 | 2个 | 5-7小时 | 短期 |
| P2 | 1个 | 2-3小时 | 长期 |
| **总计** | **5个** | **11-15小时** | - |

---

## 📁 目标文件结构

```
skills/
├── archive-summary-generator.ts        # P0 - 档案摘要生成器
├── measure-effectiveness-analyzer.ts   # P0 - 措施有效性分析器
├── snapshot-generator.ts               # P1 - 快照生成器
├── risk-change-tracker.ts              # P1 - 风险变更追踪器
├── trend-data-generator.ts             # P2 - 趋势数据生成器
└── index.ts                            # 统一导出
```

---

## ✅ 验收标准

### 代码质量
- [ ] 所有Skills都是纯函数（无副作用）
- [ ] 完整的TypeScript类型定义
- [ ] 单元测试覆盖率 > 80%
- [ ] 代码注释清晰完整

### 功能验证
- [ ] 原有功能100%正常工作
- [ ] 性能无明显下降
- [ ] 构建测试通过

### 文档完整
- [ ] 每个Skill有使用示例
- [ ] API文档完整
- [ ] 更新CONTEXT.md
- [ ] 更新CHANGELOG.md

---

## 📝 详细方案

**完整技术方案**: `docs/planning/HISTORY-ARCHIVE-SKILLS-EXTRACTION-PLAN.md`（未创建，需要时再补充）

包含内容：
- 每个Skill的详细API设计
- 核心算法伪代码
- 输入输出类型定义
- 单元测试用例
- 迁移影响分析

---

## ⏰ 执行时机

**建议时机**：
- ✅ 当前功能稳定运行3个月后
- ✅ 需要在其他项目复用该功能时
- ✅ 进行性能优化时
- ✅ 添加新的统计分析功能时

**不建议时机**：
- ❌ 正在修复关键Bug时
- ❌ 正在开发新功能时
- ❌ 演示视频制作期间

---

## 🔗 相关文档

- **功能实现**: `components/merchants/MerchantHistoryArchive.tsx`
- **数据模型**: `types/index.ts`（MerchantSnapshot等）
- **当前Skills**: `skills/` 目录（19个）
- **项目上下文**: `CONTEXT.md`

---

**状态**: 📋 已规划，等待合适时机执行
**下次评审**: 2026年5月（当前功能稳定3个月后）

**创建时间**: 2026-02-01
**创建人**: Claude Sonnet 4.5
