<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é£é™©ç­‰çº§éªŒè¯å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #6366f1;
      padding-bottom: 10px;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-section h2 {
      color: #6366f1;
      margin-top: 0;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px 10px 0;
    }
    button:hover {
      background: #4f46e5;
    }
    button:active {
      transform: scale(0.98);
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .result.success {
      background: #d1fae5;
      border-left: 4px solid #10b981;
    }
    .result.warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
    }
    .result.error {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
    }
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin: 4px;
    }
    .badge-critical { background: #e9d5ff; color: #7c3aed; }
    .badge-high { background: #fee2e2; color: #dc2626; }
    .badge-medium { background: #fed7aa; color: #ea580c; }
    .badge-low { background: #fef3c7; color: #d97706; }
    .badge-none { background: #d1fae5; color: #059669; }
    .test-case {
      display: flex;
      align-items: center;
      padding: 8px;
      margin: 8px 0;
      background: #f9fafb;
      border-radius: 4px;
    }
    .test-case .score {
      font-weight: bold;
      width: 60px;
    }
    .test-case .arrow {
      margin: 0 10px;
      color: #9ca3af;
    }
    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ V2.0 é£é™©ç­‰çº§éªŒè¯å·¥å…·</h1>

  <div class="test-section">
    <h2>ğŸ“‹ æµ‹è¯•1ï¼šé£é™©ç­‰çº§è®¡ç®—é€»è¾‘</h2>
    <p>éªŒè¯æ–°çš„5ç­‰çº§æ ‡å‡†è®¡ç®—æ˜¯å¦æ­£ç¡®</p>
    <button onclick="testCalculation()">è¿è¡Œè®¡ç®—æµ‹è¯•</button>
    <div id="calc-result"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ’¾ æµ‹è¯•2ï¼šLocalStorageæ•°æ®éªŒè¯</h2>
    <p>æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­å•†æˆ·æ•°æ®çš„é£é™©ç­‰çº§æ˜¯å¦åŒ¹é…åˆ†æ•°</p>
    <button onclick="testLocalStorage()">éªŒè¯LocalStorage</button>
    <button onclick="clearLocalStorage()" style="background: #ef4444;">æ¸…é™¤æ•°æ®</button>
    <div id="storage-result"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ¨ æµ‹è¯•3ï¼šUIé¢œè‰²æ˜¾ç¤º</h2>
    <p>é¢„è§ˆæ‰€æœ‰é£é™©ç­‰çº§çš„é¢œè‰²æ ‡ç­¾</p>
    <div style="margin-top: 15px;">
      <span class="badge badge-critical">æé«˜é£é™© (Critical)</span>
      <span class="badge badge-high">é«˜é£é™© (High)</span>
      <span class="badge badge-medium">ä¸­é£é™© (Medium)</span>
      <span class="badge badge-low">ä½é£é™© (Low)</span>
      <span class="badge badge-none">æ— é£é™© (None)</span>
    </div>
  </div>

  <div class="test-section">
    <h2>ğŸ“Š æµ‹è¯•4ï¼šè¾¹ç•Œå€¼æµ‹è¯•</h2>
    <p>æµ‹è¯•åˆ†æ•°åˆ‡æ¢ä¸´ç•Œç‚¹</p>
    <button onclick="testBoundary()">è¿è¡Œè¾¹ç•Œæµ‹è¯•</button>
    <div id="boundary-result"></div>
  </div>

  <script>
    // é£é™©ç­‰çº§è®¡ç®—å‡½æ•°ï¼ˆä¸health-calculator.tsä¿æŒä¸€è‡´ï¼‰
    function calculateRiskLevel(totalScore) {
      if (totalScore >= 90) return 'none';      // æ— é£é™©ï¼š90-100åˆ†
      if (totalScore >= 80) return 'low';       // ä½é£é™©ï¼š80-89åˆ†
      if (totalScore >= 60) return 'medium';    // ä¸­é£é™©ï¼š60-79åˆ†
      if (totalScore >= 40) return 'high';      // é«˜é£é™©ï¼š40-59åˆ†
      return 'critical';                        // æé«˜é£é™©ï¼š0-39åˆ†
    }

    function getRiskText(level) {
      const map = {
        'critical': 'æé«˜é£é™©',
        'high': 'é«˜é£é™©',
        'medium': 'ä¸­é£é™©',
        'low': 'ä½é£é™©',
        'none': 'æ— é£é™©'
      };
      return map[level] || 'æœªçŸ¥';
    }

    function testCalculation() {
      const testCases = [
        { score: 0, expected: 'critical' },
        { score: 35, expected: 'critical' },
        { score: 39, expected: 'critical' },
        { score: 40, expected: 'high' },
        { score: 45, expected: 'high' },
        { score: 59, expected: 'high' },
        { score: 60, expected: 'medium' },
        { score: 65, expected: 'medium' },
        { score: 79, expected: 'medium' },
        { score: 80, expected: 'low' },
        { score: 85, expected: 'low' },
        { score: 89, expected: 'low' },
        { score: 90, expected: 'none' },
        { score: 95, expected: 'none' },
        { score: 100, expected: 'none' }
      ];

      let results = '=== é£é™©ç­‰çº§è®¡ç®—æµ‹è¯•ç»“æœ ===\n\n';
      let passCount = 0;
      let failCount = 0;

      testCases.forEach(test => {
        const actual = calculateRiskLevel(test.score);
        const pass = actual === test.expected;
        const icon = pass ? 'âœ…' : 'âŒ';

        if (pass) passCount++;
        else failCount++;

        results += `${icon} ${test.score}åˆ† â†’ ${getRiskText(actual)} (${actual})`;
        if (!pass) {
          results += ` [æœŸæœ›: ${getRiskText(test.expected)} (${test.expected})]`;
        }
        results += '\n';
      });

      results += `\né€šè¿‡: ${passCount}/${testCases.length}  å¤±è´¥: ${failCount}/${testCases.length}`;

      const resultDiv = document.getElementById('calc-result');
      resultDiv.className = 'result ' + (failCount === 0 ? 'success' : 'error');
      resultDiv.textContent = results;
    }

    function testLocalStorage() {
      const merchants = JSON.parse(localStorage.getItem('merchants') || '[]');

      if (merchants.length === 0) {
        const resultDiv = document.getElementById('storage-result');
        resultDiv.className = 'result warning';
        resultDiv.textContent = 'âš ï¸ LocalStorageä¸­æ²¡æœ‰å•†æˆ·æ•°æ®\n\nè¯·å…ˆè®¿é—®åº”ç”¨ä¸»é¡µåˆå§‹åŒ–æ•°æ®ï¼Œæˆ–åˆ·æ–°é¡µé¢ã€‚';
        return;
      }

      let results = '=== å•†æˆ·æ•°æ®éªŒè¯ç»“æœ ===\n\n';
      let matchCount = 0;
      let mismatchCount = 0;

      merchants.forEach(m => {
        const expected = calculateRiskLevel(m.totalScore);
        const match = m.riskLevel === expected;
        const icon = match ? 'âœ…' : 'âŒ';

        if (match) matchCount++;
        else mismatchCount++;

        results += `${icon} ${m.name}: ${m.totalScore}åˆ† â†’ ${getRiskText(m.riskLevel)} (${m.riskLevel})`;
        if (!match) {
          results += `\n   æœŸæœ›: ${getRiskText(expected)} (${expected})`;
        }
        results += '\n';
      });

      // ç»Ÿè®¡å„é£é™©ç­‰çº§æ•°é‡
      const stats = {
        critical: merchants.filter(m => m.riskLevel === 'critical').length,
        high: merchants.filter(m => m.riskLevel === 'high').length,
        medium: merchants.filter(m => m.riskLevel === 'medium').length,
        low: merchants.filter(m => m.riskLevel === 'low').length,
        none: merchants.filter(m => m.riskLevel === 'none').length
      };

      results += '\n=== é£é™©ç­‰çº§åˆ†å¸ƒ ===\n';
      results += `æé«˜é£é™©: ${stats.critical}æˆ·\n`;
      results += `é«˜é£é™©: ${stats.high}æˆ·\n`;
      results += `ä¸­é£é™©: ${stats.medium}æˆ·\n`;
      results += `ä½é£é™©: ${stats.low}æˆ·\n`;
      results += `æ— é£é™©: ${stats.none}æˆ·\n`;

      results += `\nåŒ¹é…: ${matchCount}/${merchants.length}  ä¸åŒ¹é…: ${mismatchCount}/${merchants.length}`;

      const resultDiv = document.getElementById('storage-result');
      resultDiv.className = 'result ' + (mismatchCount === 0 ? 'success' : 'error');
      resultDiv.textContent = results;
    }

    function testBoundary() {
      const boundaries = [
        { score: 39, level: 'critical', nextScore: 40, nextLevel: 'high' },
        { score: 59, level: 'high', nextScore: 60, nextLevel: 'medium' },
        { score: 79, level: 'medium', nextScore: 80, nextLevel: 'low' },
        { score: 89, level: 'low', nextScore: 90, nextLevel: 'none' }
      ];

      let results = '=== è¾¹ç•Œå€¼æµ‹è¯•ç»“æœ ===\n\n';
      let passCount = 0;

      boundaries.forEach(b => {
        const actual1 = calculateRiskLevel(b.score);
        const actual2 = calculateRiskLevel(b.nextScore);
        const pass1 = actual1 === b.level;
        const pass2 = actual2 === b.nextLevel;
        const icon = (pass1 && pass2) ? 'âœ…' : 'âŒ';

        if (pass1 && pass2) passCount++;

        results += `${icon} è¾¹ç•Œ ${b.score}/${b.nextScore}:\n`;
        results += `   ${b.score}åˆ† â†’ ${getRiskText(actual1)} (${actual1}) ${pass1 ? 'âœ“' : 'âœ—'}\n`;
        results += `   ${b.nextScore}åˆ† â†’ ${getRiskText(actual2)} (${actual2}) ${pass2 ? 'âœ“' : 'âœ—'}\n\n`;
      });

      results += `é€šè¿‡: ${passCount}/${boundaries.length}`;

      const resultDiv = document.getElementById('boundary-result');
      resultDiv.className = 'result ' + (passCount === boundaries.length ? 'success' : 'error');
      resultDiv.textContent = results;
    }

    function clearLocalStorage() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤LocalStorageä¸­çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿ\n\nè¿™å°†åˆ é™¤æ‰€æœ‰å•†æˆ·ã€ä»»åŠ¡å’Œå·¡æ£€è®°å½•ã€‚\nåˆ·æ–°é¡µé¢åä¼šé‡æ–°åŠ è½½åˆå§‹æ•°æ®ã€‚')) {
        localStorage.clear();
        alert('âœ… LocalStorageå·²æ¸…é™¤ï¼\n\nè¯·åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½åˆå§‹æ•°æ®ã€‚');
        document.getElementById('storage-result').textContent = '';
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œè®¡ç®—æµ‹è¯•
    window.onload = () => {
      testCalculation();
    };
  </script>
</body>
</html>
